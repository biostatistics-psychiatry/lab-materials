---
title: "Lab: Probability rules"
number-sections: true
format: live-html
engine: knitr
webr:
  packages:
    - dplyr
    - readr
    - here
    - knitr
resources:
  - ../data/steps_baseline.rds
---

{{< include ../_extensions/r-wasm/live/_knitr.qmd >}}
{{< include ../_extensions/r-wasm/live/_gradethis.qmd >}}

In this lab, we'll practice evaluating probability rules using R. This is based on the [Probability rules](../labs/probability-rules.qmd) chapter.

::: {.callout-tip}
While you can complete all the exercises in your browser, we recommend also practicing in RStudio. Using an editor like RStudio will help you build real-world skills for writing, running, and saving your R code.
:::

# Load packages and data

First, let's load the necessary packages and data. We also create summaries of the *education* and *income* variables to be used in the exercises. Note that these do not represent real data, so the results are a bit random.

```{webr}
#| label: load-packages
#| message: false
#| envir: prob_env

library(dplyr)
library(readr)
library(here)
library(knitr)

# Load the baseline data
d_bl <- read_rds(here("data", "steps_baseline.rds"))

# Create summaries for education and income
edu_summary <- d_bl |>
  group_by(education) |>
  summarise(
    n = n(),
    proportion = n / nrow(d_bl),
    percent = round(proportion * 100, 1),
    .groups = "drop"
  )

income_summary <- d_bl |>
  group_by(income) |>
  summarise(
    n = n(),
    proportion = n / nrow(d_bl),
    percent = round(proportion * 100, 1),
    .groups = "drop"
  )

kable(income_summary)
```

# Check that the sum of all probabilities is 1

:::: {.panel-tabset}

## Problem

Do the numbers in our *income* variable add up to 1? You can use the `income_summary` object we created above.

```{webr}
#| label: ex-1
#| exercise: ex_1
#| envir: prob_env

# Calculate the sum of proportions for income
sum_income_proportions <- sum(______)

# Check if it equals 1
sum_equals_one <- sum_income_proportions == ______

# Display the result
cat("Sum of income proportions:", sum_income_proportions, "\n")
cat("Does it equal 1?", sum_equals_one, "\n")
```

## Hints

::: {.hint exercise="ex_1"}

The `income_summary` data frame has a column called `proportion` that contains the probability for each income level.

To calculate the sum, use `sum()` on the `proportion` column.

To check if it equals 1, compare the sum to 1 using `==`.

:::

## Solution

::: {.solution exercise="ex_1"}

```{webr}
#| exercise: ex_1
#| label: ex-1-solution
#| solution: true

# Calculate the sum of proportions for income
sum_income_proportions <- sum(income_summary$proportion)  #<1>

# Check if it equals 1
sum_equals_one <- sum_income_proportions == 1  #<2>

# Display the result
cat("Sum of income proportions:", sum_income_proportions, "\n")
cat("Does it equal 1?", sum_equals_one, "\n")
```

1. Sum all proportions in the income_summary data frame
2. Check if the sum equals exactly 1

The sum should equal 1, confirming that all probabilities add up correctly!

:::

```{webr}
#| exercise: ex_1
#| label: ex-1-gradethis
#| check: true
gradethis::grade_this_code()
```

::::

# Complement rule

The probability of an event not occurring is 1 minus the probability that it will occur.

Let's check this for the "Secondary" level.

$$
P(\text{not Secondary}) = 1 - P(\text{Secondary})
$$

:::: {.panel-tabset}

## Problem

Calculate the complement rule for *Medium* income.

```{webr}
#| label: ex-2
#| exercise: ex_2

# Get the probability of Medium income
p_medium <- income_summary |>
  filter(income == "Medium") |>
  pull(proportion)

# Calculate the complement (probability of NOT Medium income)
p_not_medium <- 1 - ______

# Display the results
cat("P(Medium income) =", round(p_medium, 4), "\n")
cat("P(not Medium income) =", round(p_not_medium, 4), "\n")
cat("Check complement rule, sum =", round(p_medium + p_not_medium, 4), "\n")
```

## Hints

::: {.hint exercise="ex_2"}

The complement rule states that P(not A) = 1 - P(A).

You already have `p_medium` calculated. To find the complement, subtract it from 1.

```r
p_not_medium <- 1 - p_medium
```

:::

## Solution

::: {.solution exercise="ex_2"}

```{webr}
#| exercise: ex_2
#| label: ex-2-solution
#| solution: true

# Get the probability of Medium income
p_medium <- income_summary |>
  filter(income == "Medium") |>
  pull(proportion)

# Calculate the complement (probability of NOT Medium income)
p_not_medium <- 1 - p_medium  #<1>

# Display the results
cat("P(Medium income) =", round(p_medium, 4), "\n")
cat("P(not Medium income) =", round(p_not_medium, 4), "\n")
cat("Check complement rule, sum =", round(p_medium + p_not_medium, 4), "\n")
```

1. Apply the complement rule: P(not A) = 1 - P(A)

The sum of P(Medium) and P(not Medium) should equal 1, confirming the complement rule!

:::

```{webr}
#| exercise: ex_2
#| label: ex-2-gradethis
#| check: true
gradethis::grade_this_code()
```

::::

# Addition rule

The probability that event A or event B occurs (or both).

$$P(A \cup B) = P(A) + P(B) - P(A \cap B)$$

:::: {.panel-tabset}

## Problem

Calculate the probability of having either "University" education OR being in the "Medium" income group.

```{webr}
#| label: ex-3
#| exercise: ex_3

# Get individual probabilities
p_university <- edu_summary |>
  filter(education == "University") |>
  pull(proportion)

p_medium_income <- income_summary |>
  filter(income == "Medium") |>
  pull(proportion)

# Calculate probability of both University education AND Medium income
p_both <- d_bl |>
  filter(education == "University" & income == "Medium") |>
  nrow() / nrow(d_bl)

# Apply addition rule
p_either <- p_university + p_medium_income - ______

# Display results
cat("P(University education) =", round(p_university, 4), "\n")
cat("P(Medium income) =", round(p_medium_income, 4), "\n")
cat("P(Both) =", round(p_both, 4), "\n")
cat("P(Either) =", round(p_either, 4), "\n")
```

## Hints

::: {.hint exercise="ex_3"}

The addition rule is: P(A ∪ B) = P(A) + P(B) - P(A ∩ B)

You have:
- P(A) = p_university
- P(B) = p_medium_income  
- P(A ∩ B) = p_both

So: P(A ∪ B) = p_university + p_medium_income - p_both

```r
p_either <- p_university + p_medium_income - p_both
```

:::

## Solution

::: {.solution exercise="ex_3"}

```{webr}
#| exercise: ex_3
#| label: ex-3-solution
#| solution: true

# Get individual probabilities
p_university <- edu_summary |>
  filter(education == "University") |>
  pull(proportion)

p_medium_income <- income_summary |>
  filter(income == "Medium") |>
  pull(proportion)

# Calculate probability of both University education AND Medium income
p_both <- d_bl |>
  filter(education == "University" & income == "Medium") |>
  nrow() / nrow(d_bl)

# Apply addition rule
p_either <- p_university + p_medium_income - p_both  #<1>

# Display results
cat("P(University education) =", round(p_university, 4), "\n")
cat("P(Medium income) =", round(p_medium_income, 4), "\n")
cat("P(Both) =", round(p_both, 4), "\n")
cat("P(Either) =", round(p_either, 4), "\n")
```

1. Apply the addition rule: P(A ∪ B) = P(A) + P(B) - P(A ∩ B)

The addition rule accounts for the overlap between the two events to avoid double-counting!

:::

```{webr}
#| exercise: ex_3
#| label: ex-3-gradethis
#| check: true
gradethis::grade_this_code()
```

::::

# Conditional probability

The probability of event B occurring given that event A has occurred:

$$P(B|A) = \frac{P(A \cap B)}{P(A)}$$

:::: {.panel-tabset}

## Problem

Calculate the probability of having "Medium" income given that someone has "University" education.

```{webr}
#| label: ex-4
#| exercise: ex_4

# Get probability of University education
p_university <- edu_summary |>
  filter(education == "University") |>
  pull(proportion)

# Calculate probability of both University education AND Medium income
p_both <- d_bl |>
  filter(education == "University" & income == "Medium") |>
  nrow() / nrow(d_bl)

# Calculate conditional probability
p_medium_given_university <- ______ / ______

# Display result
cat("P(Medium income | University education) =", round(p_medium_given_university, 4), "\n")
```

## Hints

::: {.hint exercise="ex_4"}

The conditional probability formula is: P(B|A) = P(A ∩ B) / P(A)

In this case:
- P(A ∩ B) = p_both (probability of both University AND Medium income)
- P(A) = p_university (probability of University education)

So: P(Medium income | University education) = p_both / p_university

```r
p_medium_given_university <- p_both / p_university
```

:::

## Solution

::: {.solution exercise="ex_4"}

```{webr}
#| exercise: ex_4
#| label: ex-4-solution
#| solution: true

# Get probability of University education
p_university <- edu_summary |>
  filter(education == "University") |>
  pull(proportion)

# Calculate probability of both University education AND Medium income
p_both <- d_bl |>
  filter(education == "University" & income == "Medium") |>
  nrow() / nrow(d_bl)

# Calculate conditional probability
p_medium_given_university <- p_both / p_university  #<1>

# Display result
cat("P(Medium income | University education) =", round(p_medium_given_university, 4), "\n")
```

1. Apply the conditional probability formula: P(B|A) = P(A ∩ B) / P(A)

This tells us the probability of having medium income among those with university education!

:::

```{webr}
#| exercise: ex_4
#| label: ex-4-gradethis
#| check: true
gradethis::grade_this_code()
```

::::

# Summary

In this lab, you learned:

1. **Probability basics**: How to verify that probabilities sum to 1
2. **Complement rule**: P(not A) = 1 - P(A)
3. **Addition rule**: P(A ∪ B) = P(A) + P(B) - P(A ∩ B)
4. **Conditional probability**: P(B|A) = P(A ∩ B) / P(A)

These fundamental probability rules are essential for understanding statistical concepts and data analysis!
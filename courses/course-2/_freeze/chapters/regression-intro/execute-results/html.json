{
  "hash": "8c0ec43d7d12e56bb289268865e0183a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Chapter 1: Introduction to Linear and Quantile Regression in R\"\nformat: \n   html:\n     df-print: kable\ntoc: true\ntoc-depth: 3\n---\n\n# Introduction\n\nThis chapter introduces the simplest possible regression model:\\\na **model with no predictors**, also known as an **intercept-only** model.\n\nEven though the model is simple, it allows us to illustrate all core components of regression:\n\n-   how R fits regression models\n-   how to extract model estimates\n-   how regression objects are structured\n-   how to get model predictions using `marginaleffects`\n-   how to visualize regression results\n-   how to compute confidence intervals and standard errors\n\n# 1. Packages and Functions\n\nIn this lab we use four core packages.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # Data wrangling and plotting\nlibrary(broom) # Converting model objects into tidy tables\nlibrary(quantreg) # Quantile regression (rq())\nlibrary(marginaleffects) # Predictions and uncertainty estimates\nlibrary(here)\n```\n:::\n\n\n**Why these packages?**\n\n-   `lm()` fits linear regression models.\n-   `rq()` fits quantile regression models.\n-   `broom` helps inspect regression objects in tidy tables.\n-   `marginaleffects` provides **model-based predictions + standard errors + confidence intervals**, even for quantile regression.\n-   `ggplot2` (part of tidyverse) allows flexible, reproducible visualizations.\n\n## Load the data\n\nWe'll again use the dataset from the STePS study, which is an RCT comparing guided and unguided internet-delivered psychodynamic therapy for social anxiety disorder. The study [is published online](https://www.nature.com/articles/s44184-024-00063-0).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_clean <- read.csv(here(\"data\", \"steps_clean.csv\"))\n\n# we also rename the \"group\" variable, otherwise it causes issues with the\n# `marginaleffects` package\ndf_clean <- df_clean |> rename(grp = group)\n```\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\nWe assign this dataset to an object called `df_clean`.\n\n# 2. Syntax of Intercept-Only Models in R\n\nAn intercept-only model estimates a **single number**:\n\n-   the **mean** for linear regression\n-   a **quantile** (e.g., median) for quantile regression\n\nThere are *no predictors*, so the model formula is simply:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nlsas_post ~ 1\n```\n\n\n:::\n:::\n\n\n## 2.1 Formula for linear regression\n\nIn the context of linear regression, this is R syntax for the formula:\n\n$$E(LSAS_{post}) = \\beta_0$$\n\nWhere $E$ refers to the expected value (mean), and $\\beta_0$ denotes the intercept. Sometimes, you may see this same model described using this formula:\n\n$$LSAS_{post_i} = \\beta_0 + \\varepsilon_i$$\n\nThat describes the same model, but highlights that the individual observations, denoted by $i$, are a function of the model intercept, $\\beta_0$, and the error term, $\\varepsilon_i$. The error term represents the unknown deviation of each observation from the population mean. Errors are closely related to **residuals**, which are the estimated errors calculated as the difference between observed values and fitted values.\n\n## 2.2 Formula for Quantile Regression\n\nQuantile regression allows us to model **a chosen quantile** of the outcome rather than the mean. For an **intercept-only** model estimating the $\\tau$-th quantile, the corresponding formula is:\n\n$$\nQ_{LSAS\\_{post}}(\\tau) = \\beta_{\\tau}\n$$\n\nHere, $Q_{LSAS\\_{post}}(\\tau)$ denotes the $\\tau$-th quantile of the outcome. For example, if $\\tau = 0.5$, the model estimates the **median**.\n\nA parallel way to write this model, showing individual observations, denoted by $i$, is:\n\n$$LSAS_{post_i} = \\beta_{\\tau} + e_i $$\n\nThis makes explicit that the “error term” $e_i$ is not assumed to have mean zero. Instead, it satisfies $P(e_i \\le 0) = \\tau$, meaning that:\n\n-   when $\\tau = 0.5$, half of the residuals fall below zero\n-   when $\\tau = 0.25$, 25% of residuals fall below zero\n-   and so on\n\nThus, whereas linear regression models the **mean**, quantile regression models the **chosen quantile** of the outcome distribution, offering a more complete view when the distribution is skewed, heavy-tailed, or heterogeneous.\n\n## 2.3 Linear regression (mean)\n\nSo let's fit an intercept-only model for the score of the LSAS scale at post-treatment in the STePS study. First we use the `lm()` function to fit the regression model. To be able to easily access the model, we save it in an object called `mod_lm`. Using the `summary()` function on this regression object gives the most essential information about the model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm <- lm(lsas_post ~ 1, data = df_clean)\nsummary(mod_lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ 1, data = df_clean)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-55.142 -18.142  -0.142  16.858  63.858 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   67.142      1.906   35.23   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 24.78 on 168 degrees of freedom\n  (12 observations deleted due to missingness)\n```\n\n\n:::\n:::\n\n\nHere, the coefficient represents the **estimated mean** of the outcome. As this is an intercept-only model (i.e., no predictors), the estimated mean is identical to the sample mean:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(df_clean$lsas_post, na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 67.14201\n```\n\n\n:::\n:::\n\n\n## 2.4 Quantile regression (median)\n\nHere we do the same thing as above, but use the `rq()` function to fit a quantile regression model, and the `summary()` function to get the most essential information.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rq <- rq(lsas_post ~ 1, tau = 0.5, data = df_clean)\nsummary(mod_rq)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall: rq(formula = lsas_post ~ 1, tau = 0.5, data = df_clean)\n\ntau: [1] 0.5\n\nCoefficients:\n(Intercept) \n         67 \n```\n\n\n:::\n:::\n\n\nThe parameter `tau` sets the quantile:\n\n-   `tau = 0.5` → median\n-   `tau = 0.1` → 10th percentile\n-   `tau = 0.9` → 90th percentile\n\nThe value of the intercept is the **estimated quantile** of the outcome. Again, since this is an intercept-only model, the value is the same as the median in the sample.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmedian(df_clean$lsas_post, na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 67\n```\n\n\n:::\n:::\n\n\n# 3. Parts of the Regression Object\n\nModel objects contain all components needed for inference. While the `summary()` function gives an overall summary of the model, there are several other functions to retrieve specific information from the regression objects.\n\n## 3.1 Components of the linear model\n\nYou can use different functions to access information from the regression R object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(mod_lm) # gives the names of the different parts of the regression object\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"coefficients\"  \"residuals\"     \"effects\"       \"rank\"         \n [5] \"fitted.values\" \"assign\"        \"qr\"            \"df.residual\"  \n [9] \"na.action\"     \"call\"          \"terms\"         \"model\"        \n```\n\n\n:::\n\n```{.r .cell-code}\ncoef(mod_lm) # returns the coefficients from the object\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept) \n   67.14201 \n```\n\n\n:::\n\n```{.r .cell-code}\nhead(fitted(mod_lm)) # gets the predicted values for each individual\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       1        3        4        6        7        8 \n67.14201 67.14201 67.14201 67.14201 67.14201 67.14201 \n```\n\n\n:::\n\n```{.r .cell-code}\nhead(residuals(mod_lm)) # returns the residuals\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         1          3          4          6          7          8 \n-17.142012   9.857988 -45.142012 -15.142012   7.857988 -22.142012 \n```\n\n\n:::\n:::\n\n\nKey parts:\n\n-   **coefficients**: the estimated mean\n-   **fitted values**: all equal to the estimated mean in the intercept-only model\n-   **residuals**: deviation of each observation from the fitted value (i.e. value predicted by the model)\n\nYou can also access specific information from the regression object by using the `$` operator.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# the coefficients of the model (right now only the intercept)\nmod_lm$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept) \n   67.14201 \n```\n\n\n:::\n\n```{.r .cell-code}\nhead(mod_lm$residuals) # the residuals (observed value - predicted value)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         1          3          4          6          7          8 \n-17.142012   9.857988 -45.142012 -15.142012   7.857988 -22.142012 \n```\n\n\n:::\n:::\n\n\n## 3.2 Components of the quantile regression model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(mod_rq)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"coefficients\"  \"x\"             \"y\"             \"residuals\"    \n [5] \"dual\"          \"fitted.values\" \"na.action\"     \"formula\"      \n [9] \"terms\"         \"call\"          \"tau\"           \"rho\"          \n[13] \"method\"        \"model\"        \n```\n\n\n:::\n\n```{.r .cell-code}\ncoef(mod_rq)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept) \n         67 \n```\n\n\n:::\n:::\n\n\nQuantile regression objects have similar structure, but contain quantile-specific information.\n\nAgain you can get information directly from the regression R object:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rq$coefficients # the coefficient\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept) \n         67 \n```\n\n\n:::\n\n```{.r .cell-code}\nhead(mod_rq$residuals) # the residuals (observed value - predicted value)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  1   3   4   6   7   8 \n-17  10 -45 -15   8 -22 \n```\n\n\n:::\n\n```{.r .cell-code}\nhead(df_clean$lsas_post)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 50 NA 77 22 NA 52\n```\n\n\n:::\n:::\n\n\n# 4. Getting Estimates from the Model Using `marginaleffects`\n\nThe `marginaleffects` package lets us extract:\n\n-   predicted values\n-   standard errors\n-   confidence intervals\n\nFor intercept-only models, predictions are **constant**. As we have no predictors that can vary between subjects, predicted values are the same across all subjects.\n\n## 4.1 Average prediction (linear regression)\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_predictions(mod_lm)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_v7wyyd4oqfzdlwf7yxmn = TinyTable.createTableFunctions(\"tinytable_v7wyyd4oqfzdlwf7yxmn\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 } ], css_id: 'tinytable_css_4g1baejcojj0f8cxsjko',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 } ], css_id: 'tinytable_css_cc1gkc98iz8vwj4pslev',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_v7wyyd4oqfzdlwf7yxmn.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_v7wyyd4oqfzdlwf7yxmn td.tinytable_css_4g1baejcojj0f8cxsjko, #tinytable_v7wyyd4oqfzdlwf7yxmn th.tinytable_css_4g1baejcojj0f8cxsjko {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_v7wyyd4oqfzdlwf7yxmn td.tinytable_css_cc1gkc98iz8vwj4pslev, #tinytable_v7wyyd4oqfzdlwf7yxmn th.tinytable_css_cc1gkc98iz8vwj4pslev {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_v7wyyd4oqfzdlwf7yxmn\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='6'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">67.1</td>\n                  <td data-row=\"1\" data-col=\"2\">1.91</td>\n                  <td data-row=\"1\" data-col=\"3\">35.2</td>\n                  <td data-row=\"1\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"5\">63.4</td>\n                  <td data-row=\"1\" data-col=\"6\">70.9</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nThis returns:\n\n-   estimated mean\n-   standard error\n-   confidence interval\n\n## 4.2 Individual predictions\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredictions(mod_lm) |> head()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_62at69a4i9qlh1a3sevi = TinyTable.createTableFunctions(\"tinytable_62at69a4i9qlh1a3sevi\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '6', j: 1 }, { i: '6', j: 2 }, { i: '6', j: 3 }, { i: '6', j: 4 }, { i: '6', j: 5 }, { i: '6', j: 6 } ], css_id: 'tinytable_css_86ha5so8fzml7buft2c2',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 } ], css_id: 'tinytable_css_v2b75ur76t2rvre19rsg',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_62at69a4i9qlh1a3sevi.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_62at69a4i9qlh1a3sevi td.tinytable_css_86ha5so8fzml7buft2c2, #tinytable_62at69a4i9qlh1a3sevi th.tinytable_css_86ha5so8fzml7buft2c2 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_62at69a4i9qlh1a3sevi td.tinytable_css_v2b75ur76t2rvre19rsg, #tinytable_62at69a4i9qlh1a3sevi th.tinytable_css_v2b75ur76t2rvre19rsg {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_62at69a4i9qlh1a3sevi\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='6'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">67.1</td>\n                  <td data-row=\"1\" data-col=\"2\">1.91</td>\n                  <td data-row=\"1\" data-col=\"3\">35.2</td>\n                  <td data-row=\"1\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"5\">63.4</td>\n                  <td data-row=\"1\" data-col=\"6\">70.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">67.1</td>\n                  <td data-row=\"2\" data-col=\"2\">1.91</td>\n                  <td data-row=\"2\" data-col=\"3\">35.2</td>\n                  <td data-row=\"2\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"2\" data-col=\"5\">63.4</td>\n                  <td data-row=\"2\" data-col=\"6\">70.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">67.1</td>\n                  <td data-row=\"3\" data-col=\"2\">1.91</td>\n                  <td data-row=\"3\" data-col=\"3\">35.2</td>\n                  <td data-row=\"3\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"3\" data-col=\"5\">63.4</td>\n                  <td data-row=\"3\" data-col=\"6\">70.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">67.1</td>\n                  <td data-row=\"4\" data-col=\"2\">1.91</td>\n                  <td data-row=\"4\" data-col=\"3\">35.2</td>\n                  <td data-row=\"4\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"4\" data-col=\"5\">63.4</td>\n                  <td data-row=\"4\" data-col=\"6\">70.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"1\">67.1</td>\n                  <td data-row=\"5\" data-col=\"2\">1.91</td>\n                  <td data-row=\"5\" data-col=\"3\">35.2</td>\n                  <td data-row=\"5\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"5\" data-col=\"5\">63.4</td>\n                  <td data-row=\"5\" data-col=\"6\">70.9</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"1\">67.1</td>\n                  <td data-row=\"6\" data-col=\"2\">1.91</td>\n                  <td data-row=\"6\" data-col=\"3\">35.2</td>\n                  <td data-row=\"6\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"6\" data-col=\"5\">63.4</td>\n                  <td data-row=\"6\" data-col=\"6\">70.9</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nThese are equal for every observation because there are no predictors.\n\n## 4.3 Median prediction (quantile regression)\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_predictions(mod_rq)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_9ylmytpvykodbdtm8sf3 = TinyTable.createTableFunctions(\"tinytable_9ylmytpvykodbdtm8sf3\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 } ], css_id: 'tinytable_css_te55ci25ns89euibn8a9',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 } ], css_id: 'tinytable_css_3kyobibtpys17h0ugug6',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_9ylmytpvykodbdtm8sf3.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_9ylmytpvykodbdtm8sf3 td.tinytable_css_te55ci25ns89euibn8a9, #tinytable_9ylmytpvykodbdtm8sf3 th.tinytable_css_te55ci25ns89euibn8a9 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_9ylmytpvykodbdtm8sf3 td.tinytable_css_3kyobibtpys17h0ugug6, #tinytable_9ylmytpvykodbdtm8sf3 th.tinytable_css_3kyobibtpys17h0ugug6 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_9ylmytpvykodbdtm8sf3\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='6'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">67</td>\n                  <td data-row=\"1\" data-col=\"2\">2.52</td>\n                  <td data-row=\"1\" data-col=\"3\">26.6</td>\n                  <td data-row=\"1\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"5\">62.1</td>\n                  <td data-row=\"1\" data-col=\"6\">71.9</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nThis returns the estimated median (or any other quantile selected).\n\n# 5. Visualizing the Model with `ggplot2`\n\nThe visualization step shows how the estimated mean or median aligns with the empirical distribution.\n\n## 5.1 Histogram with the estimated mean (linear model)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean_est <- coef(mod_lm) # save the estimated mean from the linear model\n\n# plot the mean over a histogram of the observed values\nggplot(df_clean, aes(lsas_post)) +\n  geom_histogram(bins = 25, color = \"white\") +\n  geom_vline(xintercept = mean_est, linewidth = 1.2) +\n  labs(\n    title = \"Estimated Mean (Intercept-Only Linear Model)\",\n    x = \"LSAS post-treatment score\", y = \"Frequency\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-intro_files/figure-html/plot-hist-mean-lm-1.png){width=672}\n:::\n:::\n\n\n## 5.2 Estimated mean with confidence interval (linear model)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get the estimated values from the linear regression model\nap <- avg_predictions(mod_lm)\n\n# save as a tibble for plotting\ndf_plot <- tibble(\n  mean_est = ap$estimate[1],\n  lcl = ap$conf.low[1],\n  ucl = ap$conf.high[1]\n)\n\n# use ggplot to create a plot\nggplot(df_plot, aes(y = 1, x = mean_est)) +\n  geom_point(size = 3) +\n  # add confidence interval\n  geom_errorbar(aes(xmin = lcl, xmax = ucl), width = 0.1, linewidth = 1) +\n  scale_y_continuous(breaks = NULL) + # remove the y-axis scale\n  scale_x_continuous(limits = c(50, 90)) + # set x-axis range\n  labs( # set labels\n    y = \"\",\n    x = \"Estimated Mean (95% CI)\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-intro_files/figure-html/plot-mean-ci-lm-1.png){width=672}\n:::\n:::\n\n\n## 5.3 Histogram with median (quantile regression)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmed_est <- coef(mod_rq)\n\nggplot(df_clean, aes(lsas_post)) +\n  geom_histogram(bins = 25, color = \"white\") +\n  geom_vline(xintercept = med_est, linewidth = 1.2) +\n  labs(\n    title = \"Estimated Median (Intercept-Only Quantile Regression)\",\n    x = \"LSAS post-treatment score\", y = \"Frequency\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 12 rows containing non-finite outside the scale range\n(`stat_bin()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](regression-intro_files/figure-html/plot-hist-median-rq-1.png){width=672}\n:::\n:::\n\n\n## 5.4 Estimated median with confidence interval (quantile regression)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get the estimated values from the quantile regression model\nap <- avg_predictions(mod_rq)\n\n# save as a tibble for plotting\ndf_plot <- tibble(\n  med_est = ap$estimate[1],\n  lcl = ap$conf.low[1],\n  ucl = ap$conf.high[1]\n)\n\n# use ggplot to create a plot\nggplot(df_plot, aes(y = 1, x = med_est)) +\n  geom_point(size = 3) +\n  # add confidence interval\n  geom_errorbar(aes(xmin = lcl, xmax = ucl), width = 0.1, linewidth = 1) +\n  scale_y_continuous(breaks = NULL) + # remove the y-axis scale\n  scale_x_continuous(limits = c(50, 90)) + # # set x-axis range\n  labs( # set labels\n    y = \"\",\n    x = \"Estimated Median (95% CI)\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-intro_files/figure-html/plot-median-ci-rq-1.png){width=672}\n:::\n:::\n\n\n# 6. Confidence Intervals and Standard Errors\n\nRegression models estimate a population quantity. As in the prior course, we need a measure of uncertainty.\n\n## 6.1 Linear regression\n\nR directly computes model-based CIs (which you can also get using the `avg_predictions` function):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconfint(mod_lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               2.5 %   97.5 %\n(Intercept) 63.37963 70.90439\n```\n\n\n:::\n:::\n\n\nFor an intercept-only linear regression model, these confidence intervals are identical to the ones you would get from a one-sample t-test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(df_clean$lsas_post)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tOne Sample t-test\n\ndata:  df_clean$lsas_post\nt = 35.231, df = 168, p-value < 2.2e-16\nalternative hypothesis: true mean is not equal to 0\n95 percent confidence interval:\n 63.37963 70.90439\nsample estimates:\nmean of x \n 67.14201 \n```\n\n\n:::\n:::\n\n\n## 6.2 Quantile regression\n\nQuantile regression standard errors rely on resampling:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mod_rq, se = \"boot\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall: rq(formula = lsas_post ~ 1, tau = 0.5, data = df_clean)\n\ntau: [1] 0.5\n\nCoefficients:\n            Value    Std. Error t value  Pr(>|t|)\n(Intercept) 67.00000  2.87444   23.30888  0.00000\n```\n\n\n:::\n:::\n\n\nBootstrap SEs are often more stable for quantiles.\n\n## 6.3 Using marginaleffects for CIs\n\n### Linear regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_predictions(mod_lm, conf_level = 0.95)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_bsb7p1yxv49em33v1w1s = TinyTable.createTableFunctions(\"tinytable_bsb7p1yxv49em33v1w1s\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 } ], css_id: 'tinytable_css_zdkmvzresabdmqjk9p1m',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 } ], css_id: 'tinytable_css_sld182gkbg2eypsua2k0',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_bsb7p1yxv49em33v1w1s.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_bsb7p1yxv49em33v1w1s td.tinytable_css_zdkmvzresabdmqjk9p1m, #tinytable_bsb7p1yxv49em33v1w1s th.tinytable_css_zdkmvzresabdmqjk9p1m {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_bsb7p1yxv49em33v1w1s td.tinytable_css_sld182gkbg2eypsua2k0, #tinytable_bsb7p1yxv49em33v1w1s th.tinytable_css_sld182gkbg2eypsua2k0 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_bsb7p1yxv49em33v1w1s\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='6'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">67.1</td>\n                  <td data-row=\"1\" data-col=\"2\">1.91</td>\n                  <td data-row=\"1\" data-col=\"3\">35.2</td>\n                  <td data-row=\"1\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"5\">63.4</td>\n                  <td data-row=\"1\" data-col=\"6\">70.9</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n### Quantile regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_predictions(mod_rq, conf_level = 0.95)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_atsh0g9p92w0yh1024gp = TinyTable.createTableFunctions(\"tinytable_atsh0g9p92w0yh1024gp\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 } ], css_id: 'tinytable_css_vh12udgpifdrfdxb2lov',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 } ], css_id: 'tinytable_css_x51i88fdhpfuwh5rtgfb',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_atsh0g9p92w0yh1024gp.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_atsh0g9p92w0yh1024gp td.tinytable_css_vh12udgpifdrfdxb2lov, #tinytable_atsh0g9p92w0yh1024gp th.tinytable_css_vh12udgpifdrfdxb2lov {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_atsh0g9p92w0yh1024gp td.tinytable_css_x51i88fdhpfuwh5rtgfb, #tinytable_atsh0g9p92w0yh1024gp th.tinytable_css_x51i88fdhpfuwh5rtgfb {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_atsh0g9p92w0yh1024gp\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='6'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">67</td>\n                  <td data-row=\"1\" data-col=\"2\">2.52</td>\n                  <td data-row=\"1\" data-col=\"3\">26.6</td>\n                  <td data-row=\"1\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"5\">62.1</td>\n                  <td data-row=\"1\" data-col=\"6\">71.9</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nThese produce:\n\n-   estimate\n-   standard error\n-   lower confidence limit\n-   upper confidence limit\n\nAll computed consistently across model types.\n\n# Summary\n\nIn this chapter you learned:\n\n-   how to fit **intercept-only regression models**\n-   the difference between linear (mean) and quantile (median) regression\n-   the structure of model objects\n-   how to extract prediction-based estimates using `marginaleffects`\n-   how to visualize model summaries with `ggplot`\n-   how to compute confidence intervals and standard errors\n\nThis chapter forms the foundation for working with models that include predictors, which we will explore in the next session.\n",
    "supporting": [
      "regression-intro_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "02919b51519845cdb7ebadab70968e58",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Chapter 5: Regression with Two Binary Predictors\"\nformat: html\ntoc: true\ntoc-depth: 3\n---\n\n# Introduction\n\nIn the previous chapters, we studied regression models with:\n\n-   a single binary predictor\n-   a categorical predictor with multiple levels\n-   a numeric predictor\n\nIn this chapter, we extend these ideas to **two binary predictors**.\\\nThis allows us to introduce the important concept of **conditional effects** and to distinguish between:\n\n-   **additive models** (no interaction)\n-   **interaction models** (effect modification)\n\nYou will learn:\n\n-   how to interpret models with two binary predictors\n-   what *conditional effects* mean\n-   how interactions change interpretation\n-   how to estimate and visualize effects using `marginaleffects`\n-   how linear and quantile regression handle interactions\n\n# 1. Packages and Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \nlibrary(broom) \nlibrary(quantreg) \nlibrary(marginaleffects) \nlibrary(here)\n```\n:::\n\n\n## Load data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read.csv(here(\"data\", \"steps_clean.csv\"))\ndf <- df %>% rename(grp = group)\n```\n:::\n\n\nOne of the predictors will be treatment-group. To get a binary variable (i.e. one with only two levels), we will subset the data, to include only participants in the therapist-guided or wait-list conditions. We'll called this reduced dataset `df_red.`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_red <- subset(df, trt== \"therapist-guided\" | trt== \"waitlist\")\n```\n:::\n\n\nWe convert `trt` to a factor and set `waitlist` as the reference group.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_red$trt <- factor(df_red$trt, \n                     levels = c(\"waitlist\", \"therapist-guided\")) # covert to factor,  level\" of the factor\n```\n:::\n\n\nThe other predictor will be depression severity. To get a binary variable, we dichotomize the phq9 measure from the screening time point.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_red$dep_bin <- ifelse(df_red$phq9_screen>median(df_red$phq9_screen), \"High\", \"Low\")\n\ndf_red$dep_bin <- factor(df_red$dep_bin, levels = c(\"Low\", \"High\")) # convert to factor\n\ntable(df_red$dep_bin) # show distribution\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Low High \n  65   55 \n```\n\n\n:::\n:::\n\n\n# 2. Two Binary Predictors without Interaction (Additive Model)\n\nWe begin with a model that includes both predictors **without** an interaction.\n\n## 2.1 Model formula\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlsas_post ~ trt + dep_bin\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nlsas_post ~ trt + dep_bin\n```\n\n\n:::\n:::\n\n\nThis corresponds to the linear regression model:\n\n$$E(LSAS_{post}) = \\beta_0 + \\beta_1 \\cdot trt + \\beta_2 \\cdot dep\\_bin $$\n\nWhere:\n\n-   $\\beta_0$ = mean outcome in the reference group\\\n    (waitlist & low depression)\n\n-   $\\beta_1$ = conditional treatment effect **holding depression constant**\n\n-   $\\beta_2$ = conditional depression effect **holding treatment constant**\n\n## 2.2 Interpretation of conditional effects\n\nIn this model:\n\n-   the effect of treatment is assumed to be **the same** for low and high depression\n\n-   the effect of depression is assumed to be **the same** in both treatment groups\n\nThis is called an **additive model**, (because the effects of the two predictors are added to each other).\n\n# 3. Linear Regression without Interaction\n\n## 3.1 Fit the model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm_add <- lm(lsas_post ~ trt + dep_bin, data = df_red)\nsummary(mod_lm_add)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ trt + dep_bin, data = df_red)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-67.546 -14.212  -1.262  15.377  66.023 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)           74.623      3.870  19.281  < 2e-16 ***\ntrttherapist-guided  -20.646      4.576  -4.511 1.63e-05 ***\ndep_binHigh            7.923      4.592   1.725   0.0873 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 24.16 on 109 degrees of freedom\n  (8 observations deleted due to missingness)\nMultiple R-squared:  0.1823,\tAdjusted R-squared:  0.1673 \nF-statistic: 12.15 on 2 and 109 DF,  p-value: 1.727e-05\n```\n\n\n:::\n:::\n\n\n### Interpretation\n\n-   **Intercept**: mean LSAS at post-treatment in waitlist & low depression.\n\n-   **trt coefficient**: mean difference between therapist-guided and waitlist,\\\n    adjusted for depression. The mean LSAS psot score in the therapist-guided group is \\~21 points lower than in the waitlist group.\n\n-   **dep_bin coefficient**: mean difference between high and low depression,\\\n    adjusted for treatment. The mean LSAS psot score in the low-depression group is \\~8 points lower than in the high-depression group.\n\n## 3.2 Predicted means by group\n\nWe can now use the `marginaleffects` package to get the estimated means for each of the four groups, i.e. the *conditional* estimated means.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_predictions(mod_lm_add, by = c(\"trt\", \"dep_bin\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n              trt dep_bin Estimate Std. Error    z Pr(>|z|)     S 2.5 % 97.5 %\n waitlist            Low      74.6       3.87 19.3   <0.001 272.8  67.0   82.2\n waitlist            High     82.5       3.96 20.8   <0.001 317.6  74.8   90.3\n therapist-guided    Low      54.0       3.83 14.1   <0.001 147.7  46.5   61.5\n therapist-guided    High     61.9       4.21 14.7   <0.001 159.8  53.6   70.2\n\nType: response\n```\n\n\n:::\n:::\n\n\n## 3.3 Treatment effect as a conditional contrast\n\nWe can get the conditional treatment effects across both groups using the `marginaleffects` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(mod_lm_add, \n                variables = \"trt\",\n                by = \"dep_bin\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n dep_bin Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n    Low     -20.6       4.58 -4.51   <0.001 17.2 -29.6  -11.7\n    High    -20.6       4.58 -4.51   <0.001 17.2 -29.6  -11.7\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\nSince we specified the model as additive, the treatment effect is the same in both depression groups.\n\n## 3.4 Treatment effect as a marginal contrast\n\nThe marginal contrast averages over the conditional contrasts. Since these are the same in this model, the marginal effect will be identical to the conditional effects.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(mod_lm_add, variables = \"trt\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n    -20.6       4.58 -4.51   <0.001 17.2 -29.6  -11.7\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\n# 4. Adding an Interaction\n\nNow we allow the treatment effect to differ depending on depression severity.\n\n## 4.1 Model formula with interaction\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlsas_post ~ trt * dep_bin\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nlsas_post ~ trt * dep_bin\n```\n\n\n:::\n:::\n\n\nWhich expands to:\n\n$$ E(LSAS_{post}) = \\beta_0 + \\beta_1 trt + \\beta_2 dep\\_bin + \\beta_3 (trt \\times dep\\_bin)$$\n\n-   $\\beta_3$ is the **interaction term**\n\n-   it captures how the treatment effect changes with depression level\n\nWe now allow for different treatment effects **depending on the level of depression**, rather that the treatment effect just adding to the depression effect as in the additive model.\n\n# 5. Linear Regression with Interaction\n\n## 5.1 Fit the interaction model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm_int <- lm(lsas_post ~ trt * dep_bin, data = df_red)\nsummary(mod_lm_int)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ trt * dep_bin, data = df_red)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-68.964 -13.517  -0.237  14.286  64.742 \n\nCoefficients:\n                                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                       73.300      4.424  16.570  < 2e-16 ***\ntrttherapist-guided              -18.042      6.205  -2.907  0.00442 ** \ndep_binHigh                       10.664      6.367   1.675  0.09683 .  \ntrttherapist-guided:dep_binHigh   -5.748      9.220  -0.624  0.53427    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 24.23 on 108 degrees of freedom\n  (8 observations deleted due to missingness)\nMultiple R-squared:  0.1852,\tAdjusted R-squared:  0.1626 \nF-statistic: 8.183 on 3 and 108 DF,  p-value: 5.869e-05\n```\n\n\n:::\n:::\n\n\n### Interpretation\n\n-   The treatment effect is **conditional on depression severity**\n\n-   Main effects are now interpreted **at the reference level** of the other variable\n\n-   The interaction coefficient represents the **difference in the treatment effect between participants with high versus low depression**. It tells us that the treatment effect is \\~6 points greater in the high-depression group compared with the treatment effect in the low-depression group.\n\n## 5.2 Conditional treatment effects\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\n  mod_lm_int,\n  variables = \"trt\",\n  by = \"dep_bin\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n dep_bin Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n    Low     -18.0       6.21 -2.91  0.00364  8.1 -30.2  -5.88\n    High    -23.8       6.82 -3.49  < 0.001 11.0 -37.2 -10.43\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\nThese estimates answer:\n\n> What is the treatment effect **within each level of depression severity** (low vs high)?\n\nIn this interaction model, the treatment effect is allowed to differ depending on baseline depression.\n\n## 5.2 Marginal treatment effects\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\nmod_lm_int,\nvariables = \"trt\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Estimate Std. Error    z Pr(>|z|)    S 2.5 % 97.5 %\n    -20.7       4.59 -4.5   <0.001 17.2 -29.7  -11.7\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\nThis estimate is the **marginal (population-average) treatment effect.** It is obtained by averaging the conditional treatment effects over the observed distribution of low and high depression in the sample. Because we allowed the effect to differ between the depression groups, this estimate is no longer identical to the conditional estimate of `trt` from the model, or to the conditional contrasts above.\n\n# 6. Quantile Regression with Two Binary Predictors\n\nNow let's do the same thing with quantile regression\n\n## 6.1 Additive model (median differences)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rq_add <- rq(\nlsas_post ~ trt + dep_bin,\ntau = 0.5,\ndata = df_red\n)\nsummary(mod_rq_add)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall: rq(formula = lsas_post ~ trt + dep_bin, tau = 0.5, data = df_red)\n\ntau: [1] 0.5\n\nCoefficients:\n                    coefficients lower bd  upper bd \n(Intercept)          74.00000     61.64348  81.35652\ntrttherapist-guided -24.00000    -32.87924 -14.24152\ndep_binHigh          10.00000     -4.86453  16.86453\n```\n\n\n:::\n:::\n\n\n## 6.2 Interaction model (median differences)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rq_int <- rq(\nlsas_post ~ trt * dep_bin,\ntau = 0.5,\ndata = df_red\n)\nsummary(mod_rq_int)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall: rq(formula = lsas_post ~ trt * dep_bin, tau = 0.5, data = df_red)\n\ntau: [1] 0.5\n\nCoefficients:\n                                coefficients lower bd  upper bd \n(Intercept)                      74.00000     68.36922  78.54359\ntrttherapist-guided             -22.00000    -30.47806 -10.56581\ndep_binHigh                      12.00000     -2.15693  20.25540\ntrttherapist-guided:dep_binHigh -11.00000    -22.36022  11.36022\n```\n\n\n:::\n:::\n\n\n## 6.3 Conditional median treatment effects\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\nmod_rq_int,\nvariables = \"trt\",\nby = \"dep_bin\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n dep_bin Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n    Low       -22       5.60 -3.93   <0.001 13.5 -33.0  -11.0\n    High      -33       9.77 -3.38   <0.001 10.4 -52.2  -13.8\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\n## 6.4 Marginal median treatment effects\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\nmod_rq_int,\nvariables = \"trt\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n      -27        5.4 -5.01   <0.001 20.8 -37.6  -16.4\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\n# 7. Visualization\n\n## 7.1 Group means (additive model)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nap <- avg_predictions(mod_lm_add, by = c(\"trt\", \"dep_bin\"))\n\nggplot(ap, aes(x = trt, y = estimate, color = dep_bin, group = dep_bin)) +\ngeom_point(size = 3) +\ngeom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +\ngeom_line() +\nlabs(\nx = \"Treatment group\",\ny = \"Estimated Mean LSAS (95% CI)\",\ncolor = \"Depression\",\ntitle = \"Additive Model: Group Means\"\n) +\ntheme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-two-binary-predictors_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n## 7.2 Group means (interaction model)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nap <- avg_predictions(mod_lm_int, by = c(\"trt\", \"dep_bin\"))\n\nggplot(ap, aes(x = trt, y = estimate, color = dep_bin, group = dep_bin)) +\ngeom_point(size = 3) +\ngeom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +\ngeom_line() +\nlabs(\nx = \"Treatment group\",\ny = \"Estimated Mean LSAS (95% CI)\",\ncolor = \"Depression\",\ntitle = \"Interaction Model: Conditional Means\"\n) +\ntheme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-two-binary-predictors_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\nHere we see the difference between the additive and the interaction model clearly. Since the additive model assumed additivity, the lines are exactly parallel (i.e. the tratment effect is the same for the low vs high depression group). In the interaction model, we have allowed the treatment effects to differ by depression level, and we see that the high-depression group improves more than the low depression group.\n\n# Summary\n\nIn this chapter you learned:\n\n-   how to fit regression models with **two binary predictors**\n\n-   the meaning of **conditional effects**\n\n-   the difference between additive and interaction models\n\n-   how interactions change coefficient interpretation\n\n-   how to estimate conditional effects using `marginaleffects`\n\n-   how to visualize interactions using predicted values\n\nThis chapter completes the foundation for understanding **effect modification**, which is essential for applied regression and causal interpretation.",
    "supporting": [
      "regression-two-binary-predictors_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "e68cc374438eda40c0766fb539305d71",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Chapter 2: Regression with a Binary Predictor\"\nformat: html\neditor: visual\ntoc: true\ntoc-depth: 3\n---\n\n\n\n# Introduction\n\nIn the previous chapter, we studied **intercept-only regression models**, which estimate a single summary of the outcome (a mean or a quantile).\n\nIn this chapter, we extend that framework by adding **one binary predictor**, called `trt`.\n\nThis is the simplest possible *comparative* regression model and corresponds to:\n\n-   a **two-sample t-test** in linear regression\n-   a **comparison of quantiles** in quantile regression\n\nThis chapter introduces how regression models encode **group differences**.\n\nYou will learn:\n\n-   how binary predictors enter regression models\n-   how to interpret intercepts and slopes with binary variables\n-   how group means and differences are estimated\n-   how to obtain predicted values for each group\n-   how to visualize group comparisons\n-   how linear and quantile regression differ in interpretation\n\n# 1. Packages and Data\n\nWe use the same packages as before.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \nlibrary(broom) \nlibrary(quantreg) \nlibrary(marginaleffects) \nlibrary(here)\n```\n:::\n\n\n\n## Load data\n\nAnd load the same data as before\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read.csv(here(\"data\", \"steps_clean.csv\"))\ndf <- df %>% rename(grp = group)\n```\n:::\n\n\n\nWe will use the treatment indicator variable `trt` as our predictor. In the original data, this indicator has three levels:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(as.factor(df$trt))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"self-guided\"      \"therapist-guided\" \"waitlist\"        \n```\n\n\n:::\n:::\n\n\n\nTo get a binary variable (i.e. one with only two levels), we will subset the data, to include only participants in the therapist-guided or wait-list conditions. We'll called this reduced dataset `df_red.`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_red <- subset(df, trt== \"therapist-guided\" | trt== \"waitlist\")\n```\n:::\n\n\n\nWe transform the `trt` variable to a factor, and make sure that the wait-list condition is used a the reference.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_red$trt <- factor(df_red$trt, \n                     levels = c(\"waitlist\", \"therapist-guided\")) # covert to factor,  level\" of the factor\n```\n:::\n\n\nBy listing the waitlist as the first level, the becomes the \"reference\"\n\n# 2. Regression with a Binary Predictor\n\nWith a binary predictor, the regression model estimates **two quantities**:\n\n1.  the expected outcome in the reference group\n\n2.  the difference between groups\n\n## 2.1 Model formula\n\nHere is the R syntax for the regression model for the LSAS post-treatment score, `lsas_post`, including only an intercept and the `trt` varibale as a predictor (the intercept `~1` from the last model is implied, but can also be written out).\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nlsas_post ~ trt\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nlsas_post ~ 1 + trt\n```\n\n\n:::\n:::\n\n\n\nThis corresponds to the linear regression model:\n\n$$\nE(LSAS_{post}) = \\beta_0 + \\beta_1 \\cdot trt \n$$\n\nWhere:\n\n-   $\\beta_0$ is the expected outcome when `trt = 0` (waitlist group, since this is coded as the reference level)\n\n-   $\\beta_1$is the **mean difference** between the waitlist and the therapist-guided groups\n\nFor individual observations:\n\n$$LSAS_{post_i} = \\beta_0 + \\beta_1trt + \\epsilon_i $$\n\n## 2.2 Interpretation of coefficients\n\n| trt                  | Predicted value     |\n|----------------------|---------------------|\n| 0 (waitlist)         | $\\beta_0$           |\n| 1 (therapist-guided) | $\\beta_0 + \\beta_1$ |\n\nThus:\n\n-   $\\beta_0$ = mean (or quantile) in the control group\n\n-   $\\beta_1$= difference in mean (or quantile) between the groups (i.e. treatment effect)\n\n# 3. Linear Regression (Mean Differences)\n\n## 3.1 Fit the model\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm <- lm(lsas_post ~ trt, data = df_red)\nsummary(mod_lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ trt, data = df_red)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-64.448 -13.448  -1.948  12.624  62.648 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)           78.448      3.201  24.508  < 2e-16 ***\ntrttherapist-guided  -21.096      4.610  -4.576 1.25e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 24.38 on 110 degrees of freedom\n  (8 observations deleted due to missingness)\nMultiple R-squared:  0.1599,\tAdjusted R-squared:  0.1523 \nF-statistic: 20.94 on 1 and 110 DF,  p-value: 1.25e-05\n```\n\n\n:::\n:::\n\n\n\n### Interpretation\n\n-   **Intercept**: estimated mean LSAS score in the control group\n\n-   **trt coefficient**: estimated mean difference between therapist-guided and waitlist, showing that the mean value of LSAS at post was 21 point lower in the therapist-guided group that in the waitlist group\n\nWe can verify these directly from the data:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_red %>%\ngroup_by(trt) %>%\nsummarize(mean_lsas = mean(lsas_post, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  trt              mean_lsas\n  <fct>                <dbl>\n1 waitlist              78.4\n2 therapist-guided      57.4\n```\n\n\n:::\n:::\n\n\n\nThe difference between these two means equals the estimated coefficient for `trt.`\n\n## 3.2 Relationship to the t-test\n\nThis regression model is mathematically equivalent to a two-sample t-test:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(lsas_post ~ trt, data = df_red, var.equal=TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  lsas_post by trt\nt = 4.5763, df = 110, p-value = 1.25e-05\nalternative hypothesis: true difference in means between group waitlist and group therapist-guided is not equal to 0\n95 percent confidence interval:\n 11.96065 30.23220\nsample estimates:\n        mean in group waitlist mean in group therapist-guided \n                      78.44828                       57.35185 \n```\n\n\n:::\n:::\n\n\n\nRegression generalizes the t-test by allowing:\n\n-   additional predictors\n\n-   non-normal outcomes\n\n-   different estimands (e.g., quantiles)\n\n# 4. Quantile Regression (quantile difference)\n\n## 4.1 Model formulation\n\nFor quantile regression at quantile $\\tau$:\n\n$$\nQ_{LSAS_{post}}(\\tau) =  \\beta_0,\\tau + \\beta_1, \\tau \\cdot trt \n$$\n\n-   $\\beta_0,\\tau$ = $\\tau$-th quantile in the control group\n\n-   $\\beta_1,\\tau$ = difference in quantiles between groups\n\n## 4.2 Fit a median regression\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rq <- rq(lsas_post ~ trt, tau = 0.5, data = df_red)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in rq.fit.br(x, y, tau = tau, ...): Solution may be nonunique\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(mod_rq)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in rq.fit.br(x, y, tau = tau, ci = TRUE, ...): Solution may be\nnonunique\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall: rq(formula = lsas_post ~ trt, tau = 0.5, data = df_red)\n\ntau: [1] 0.5\n\nCoefficients:\n                    coefficients lower bd  upper bd \n(Intercept)          77.00000     71.68339  84.63323\ntrttherapist-guided -24.00000    -31.77207 -16.61396\n```\n\n\n:::\n:::\n\n\n\nWe can again verify group medians directly:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_red %>%\ngroup_by(trt) %>%\nsummarize(median_lsas = median(lsas_post, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  trt              median_lsas\n  <fct>                  <dbl>\n1 waitlist                77  \n2 therapist-guided        52.5\n```\n\n\n:::\n:::\n\n\n\n# 5. Model Objects and Coefficients\n\n## 5.1 Linear regression object\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(mod_lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"coefficients\"  \"residuals\"     \"effects\"       \"rank\"         \n [5] \"fitted.values\" \"assign\"        \"qr\"            \"df.residual\"  \n [9] \"na.action\"     \"contrasts\"     \"xlevels\"       \"call\"         \n[13] \"terms\"         \"model\"        \n```\n\n\n:::\n\n```{.r .cell-code}\ncoef(mod_lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        (Intercept) trttherapist-guided \n           78.44828           -21.09642 \n```\n\n\n:::\n:::\n\n\n\n-   `(Intercept)` → control group mean\n\n<!-- -->\n\n-   `trt` → mean difference\n\nPredicted values for the 8 first participants (determined only by their group, with all being in the therapist-guided group)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(fitted(mod_lm))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       1        3        4        6        7        8 \n57.35185 78.44828 57.35185 57.35185 57.35185 57.35185 \n```\n\n\n:::\n:::\n\n\n\n## 5.2 Quantile regression object\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoef(mod_rq)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        (Intercept) trttherapist-guided \n                 77                 -24 \n```\n\n\n:::\n:::\n\n\n\nInterpretation is parallel, but refers to **quantiles instead of means**.\n\n# 6. Predictions Using `marginaleffects`\n\nThe `marginaleffects` package allows us to compute **group-specific predictions**. This allows us to see confidence intervals for the mean (or quantile) for each group, as well as the CI for the mean (or quantile) difference between the groups.\n\n## 6.1 Predicted means by group (linear regression)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_predictions(mod_lm, by = \"trt\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n              trt Estimate Std. Error    z Pr(>|z|)     S 2.5 % 97.5 %\n waitlist             78.4       3.20 24.5   <0.001 438.2  72.2   84.7\n therapist-guided     57.4       3.32 17.3   <0.001 220.0  50.8   63.9\n\nType: response\n```\n\n\n:::\n:::\n\n\n\nThis returns:\n\n-   predicted mean in each group\n\n-   standard errors\n\n-   confidence intervals for each predicted mean\n\n## 6.2 Predicted medians by group (quantile regression)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_predictions(mod_rq, by = \"trt\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n              trt Estimate Std. Error    z Pr(>|z|)     S 2.5 % 97.5 %\n waitlist               77       3.09 24.9   <0.001 451.6  70.9   83.1\n therapist-guided       53       3.71 14.3   <0.001 151.1  45.7   60.3\n\nType: response\n```\n\n\n:::\n:::\n\n\n\n## 6.3 Treatment effect as a contrast\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(mod_lm, variables = \"trt\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n    -21.1       4.61 -4.58   <0.001 17.7 -30.1  -12.1\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\n\nFor quantile regression:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(mod_rq, variables = \"trt\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n      -24       4.83 -4.97   <0.001 20.5 -33.5  -14.5\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\n\n# 7. Visualization\n\n## 7.1 Group means with confidence intervals\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nap <- avg_predictions(mod_lm, by = \"trt\")\n\nggplot(ap, aes(x = factor(trt), y = estimate)) +\ngeom_point(size = 3) +\ngeom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +\nlabs(\nx = \"Treatment group\",\ny = \"Estimated Mean LSAS (95% CI)\",\ntitle = \"Estimated Group Means from Linear Regression\"\n) +\ntheme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-one-binary-predictor_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n## 7.2 Group medians with confidence intervals\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nap <- avg_predictions(mod_rq, by = \"trt\")\n\nggplot(ap, aes(x = factor(trt), y = estimate)) +\ngeom_point(size = 3) +\ngeom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +\nlabs(\nx = \"Treatment group\",\ny = \"Estimated Median LSAS (95% CI)\",\ntitle = \"Estimated Group Medians from Quantile Regression\"\n) +\ntheme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-one-binary-predictor_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n# Summary\n\nIn this chapter you learned:\n\n-   how binary predictors enter regression models\n\n-   how intercepts and coefficients (slopes) encode group means and differences\n\n-   how linear regression estimates **mean differences**\n\n-   how quantile regression estimates **quantile differences**\n\n-   how regression relates to t-tests\n\n-   how to obtain predictions, contrasts, and confidence intervals\n\n-   how to visualize group comparisons\n\nThis chapter provides the foundation for models with **categorical predictors and later numeric predictors, and multiple predictors**.\n",
    "supporting": [
      "regression-one-binary-predictor_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "178aa3475a1ccbc630870c8fbddf8679",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Chapter 4: Regression with a Numeric Predictor\"\nformat: \n   html:\n     df-print: kable\ntoc: true\ntoc-depth: 3\n---\n\n# Introduction\n\nIn the previous chapters, we studied regression models with:\n\n- no predictors (intercept-only models)\n- binary predictors\n- categorical predictors with multiple levels\n\nIn this chapter, we move to a **numeric predictor**, called `gad_screen`.\n\nNumeric predictors allow us to model **continuous relationships**, where the expected outcome changes smoothly as the predictor changes.\n\nYou will learn:\n\n- how numeric predictors enter regression models\n- how to interpret intercepts and slopes\n- how linear regression models **mean trends**\n- how quantile regression models **quantile trends**\n- how to obtain predicted values across a range of the predictor\n- how to visualize regression lines and uncertainty\n- how to account for non-linear relationships between the predictor and the outcome\n\n# 1. Packages and Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(quantreg)\nlibrary(marginaleffects)\nlibrary(parameters)\nlibrary(here)\n```\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\n## Load data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_clean <- read.csv(here(\"data\", \"steps_clean.csv\"))\ndf_clean <- df_clean |> rename(grp = group)\n```\n:::\n\n\nWe will use `gad_screen`, a numeric measure of generalized anxiety symptoms at screening, as our predictor.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(df_clean$gad_screen)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   1.00    7.00   10.00   10.86   14.00   21.00 \n```\n\n\n:::\n:::\n\n\n# 2. Regression with a Numeric Predictor\n\nWith a numeric predictor, the regression model estimates:\n\n1.  the expected outcome when the predictor equals zero\n2.  the **change in the outcome** associated with a one-unit increase in the predictor\n\n## 2.1 Model formula\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nlsas_post ~ gad_screen\n```\n\n\n:::\n:::\n\n\nThis corresponds to the linear regression model for the conditional mean:\n\n$$\n\\mathbb{E}(LSAS_{post,i} \\mid gad\\_screen_i) = \\beta_0 + \\beta_1\\, gad\\_screen_i\n$$\n\nWhere:\n\n- $\\beta_0$ is the expected LSAS score when `gad_screen = 0`\n- $\\beta_1$ is the expected **change in the mean LSAS** for a one-unit increase in `gad_screen`\n\nFor individual observations:\n\n$$\nLSAS_{post,i} = \\beta_0 + \\beta_1 \\, gad\\_screen_i + \\epsilon_i\n$$\n\n# 3. Linear Regression (Mean Trend)\n\n## 3.1 Fit the model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm <- lm(lsas_post ~ gad_screen, data = df_clean)\nsummary(mod_lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ gad_screen, data = df_clean)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-65.031 -18.149   1.527  16.674  64.527 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  56.6502     4.8858  11.595   <2e-16 ***\ngad_screen    0.9705     0.4171   2.327   0.0212 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 24.46 on 167 degrees of freedom\n  (12 observations deleted due to missingness)\nMultiple R-squared:  0.0314,\tAdjusted R-squared:  0.0256 \nF-statistic: 5.414 on 1 and 167 DF,  p-value: 0.02118\n```\n\n\n:::\n:::\n\n\n### Interpretation\n\n- The **intercept** represents the estimated mean LSAS score when `gad_screen = 0`\n- The **slope** (coefficient) represents how much the mean LSAS score changes per unit increase in baseline anxiety\n\nA positive slope indicates higher post-treatment LSAS scores among participants with higher baseline anxiety. For each one-unit increase in GAD-7 at screening, the expected mean LSAS at post increases by approximately 0.97 points.\n\n## 3.2 Relationship to correlation\n\nWith a single numeric predictor, linear regression is closely related to Pearson correlation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor(df_clean$lsas_post, df_clean$gad_screen, use = \"complete.obs\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1772046\n```\n\n\n:::\n:::\n\n\nIn fact, if we standardize both the predictor and the outcome to z-scores with mean = 0 and SD = 1, the correlation and the coefficient will be almost identical with only one numeric predictor. This can be done using the `scale()` function within the regression:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoef(lm(scale(lsas_post) ~ scale(gad_screen), data = df_clean))[2]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nscale(gad_screen) \n        0.1765964 \n```\n\n\n:::\n\n```{.r .cell-code}\ncor(df_clean$lsas_post, df_clean$gad_screen, use = \"complete.obs\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1772046\n```\n\n\n:::\n:::\n\n\nAlternatively, we can also use the `parameters`-package to get standardized coefficients.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstandardize_parameters(mod_lm, method = \"basic\")\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|Parameter   | Std_Coefficient|   CI|    CI_low|   CI_high|\n|:-----------|---------------:|----:|---------:|---------:|\n|(Intercept) |       0.0000000| 0.95| 0.0000000| 0.0000000|\n|gad_screen  |       0.1772046| 0.95| 0.0268487| 0.3275605|\n\n</div>\n:::\n:::\n\n\n# 4. Quantile Regression (Quantile Trends)\n\n## 4.1 Model formulation\n\nFor quantile regression at quantile $\\tau$:\n\n$$\nQ_{LSAS_{post} \\mid gad\\_screen}(\\tau \\mid gad\\_screen_i) =  \\beta_0(\\tau) + \\beta_1(\\tau) \\, gad\\_screen_i\n$$\n\n- $\\beta_0(\\tau)$ = $\\tau$-th quantile when `gad_screen = 0`\n- $\\beta_1(\\tau)$ = change in the $\\tau$-th quantile per one-unit increase in `gad_screen`\n\n## 4.2 Fit a median regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rq <- rq(lsas_post ~ gad_screen, tau = 0.5, data = df_clean)\nsummary(mod_rq)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall: rq(formula = lsas_post ~ gad_screen, tau = 0.5, data = df_clean)\n\ntau: [1] 0.5\n\nCoefficients:\n            coefficients lower bd upper bd\n(Intercept) 61.72727     50.89555 74.72628\ngad_screen   0.45455     -0.92040  2.38616\n```\n\n\n:::\n:::\n\n\nThe slope now describes how the **median** LSAS score changes as baseline anxiety increases.\n\n# 5. Model Objects and Coefficients\n\n## 5.1 Linear regression object\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(mod_lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"coefficients\"  \"residuals\"     \"effects\"       \"rank\"         \n [5] \"fitted.values\" \"assign\"        \"qr\"            \"df.residual\"  \n [9] \"na.action\"     \"xlevels\"       \"call\"          \"terms\"        \n[13] \"model\"        \n```\n\n\n:::\n\n```{.r .cell-code}\ncoef(mod_lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept)  gad_screen \n 56.6502034   0.9705066 \n```\n\n\n:::\n:::\n\n\n- `(Intercept)`: expected mean at `gad_screen = 0`\n- `gad_screen`: mean change per unit increase\n\n## 5.2 Quantile regression object\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoef(mod_rq)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept)  gad_screen \n 61.7272727   0.4545455 \n```\n\n\n:::\n:::\n\n\n# 6. Predictions Using `marginaleffects`\n\nWith numeric predictors, predictions depend on the value of the predictor. We therefore compute predictions across a **range of values**.\n\n## 6.1 Predicted means across `gad_screen`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a grid of gad_screen values (50 points from min to max)\nnewdat <- datagrid(\n  newdata = df_clean,\n  gad_screen = seq(\n    min(df_clean$gad_screen, na.rm = TRUE),\n    max(df_clean$gad_screen, na.rm = TRUE),\n    length.out = 50\n  )\n)\n\n# Get predictions from the linear model at those values\npred_lm <- predictions(mod_lm, newdata = newdat)\npred_lm\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_93kszr0csw0x212k4qwz = TinyTable.createTableFunctions(\"tinytable_93kszr0csw0x212k4qwz\");\n      // tinytable span after\n      window.addEventListener('load', function () { tableFns_93kszr0csw0x212k4qwz.spanCell(6, 1, 1, 7) })\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '11', j: 1 }, { i: '11', j: 2 }, { i: '11', j: 3 }, { i: '11', j: 4 }, { i: '11', j: 5 }, { i: '11', j: 6 }, { i: '11', j: 7 } ], css_id: 'tinytable_css_7y34z6iwl4djbkhmxz1m',}, \n          { positions: [ { i: '6', j: 1 }, { i: '6', j: 2 }, { i: '6', j: 3 }, { i: '6', j: 4 }, { i: '6', j: 5 }, { i: '6', j: 6 }, { i: '6', j: 7 } ], css_id: 'tinytable_css_hxvnzhfcwbm1npuf3pi4',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 } ], css_id: 'tinytable_css_dhukz6nakbme8gc94ivn',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_93kszr0csw0x212k4qwz.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_93kszr0csw0x212k4qwz td.tinytable_css_7y34z6iwl4djbkhmxz1m, #tinytable_93kszr0csw0x212k4qwz th.tinytable_css_7y34z6iwl4djbkhmxz1m {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_93kszr0csw0x212k4qwz td.tinytable_css_hxvnzhfcwbm1npuf3pi4, #tinytable_93kszr0csw0x212k4qwz th.tinytable_css_hxvnzhfcwbm1npuf3pi4 { text-align: center }\n    #tinytable_93kszr0csw0x212k4qwz td.tinytable_css_dhukz6nakbme8gc94ivn, #tinytable_93kszr0csw0x212k4qwz th.tinytable_css_dhukz6nakbme8gc94ivn {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_93kszr0csw0x212k4qwz\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">gad_screen</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"7\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='7'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">1.00</td>\n                  <td data-row=\"1\" data-col=\"2\">57.6</td>\n                  <td data-row=\"1\" data-col=\"3\">4.50</td>\n                  <td data-row=\"1\" data-col=\"4\">12.8</td>\n                  <td data-row=\"1\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"6\">48.8</td>\n                  <td data-row=\"1\" data-col=\"7\">66.4</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">1.41</td>\n                  <td data-row=\"2\" data-col=\"2\">58.0</td>\n                  <td data-row=\"2\" data-col=\"3\">4.35</td>\n                  <td data-row=\"2\" data-col=\"4\">13.3</td>\n                  <td data-row=\"2\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"2\" data-col=\"6\">49.5</td>\n                  <td data-row=\"2\" data-col=\"7\">66.5</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">1.82</td>\n                  <td data-row=\"3\" data-col=\"2\">58.4</td>\n                  <td data-row=\"3\" data-col=\"3\">4.20</td>\n                  <td data-row=\"3\" data-col=\"4\">13.9</td>\n                  <td data-row=\"3\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"3\" data-col=\"6\">50.2</td>\n                  <td data-row=\"3\" data-col=\"7\">66.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">2.22</td>\n                  <td data-row=\"4\" data-col=\"2\">58.8</td>\n                  <td data-row=\"4\" data-col=\"3\">4.05</td>\n                  <td data-row=\"4\" data-col=\"4\">14.5</td>\n                  <td data-row=\"4\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"4\" data-col=\"6\">50.9</td>\n                  <td data-row=\"4\" data-col=\"7\">66.7</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"1\">2.63</td>\n                  <td data-row=\"5\" data-col=\"2\">59.2</td>\n                  <td data-row=\"5\" data-col=\"3\">3.90</td>\n                  <td data-row=\"5\" data-col=\"4\">15.2</td>\n                  <td data-row=\"5\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"5\" data-col=\"6\">51.6</td>\n                  <td data-row=\"5\" data-col=\"7\">66.8</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"1\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"2\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"3\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"4\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"5\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"6\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"7\">40 rows omitted</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"1\">19.37</td>\n                  <td data-row=\"7\" data-col=\"2\">75.4</td>\n                  <td data-row=\"7\" data-col=\"3\">4.03</td>\n                  <td data-row=\"7\" data-col=\"4\">18.7</td>\n                  <td data-row=\"7\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"7\" data-col=\"6\">67.5</td>\n                  <td data-row=\"7\" data-col=\"7\">83.4</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"1\">19.78</td>\n                  <td data-row=\"8\" data-col=\"2\">75.8</td>\n                  <td data-row=\"8\" data-col=\"3\">4.19</td>\n                  <td data-row=\"8\" data-col=\"4\">18.1</td>\n                  <td data-row=\"8\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"8\" data-col=\"6\">67.6</td>\n                  <td data-row=\"8\" data-col=\"7\">84.0</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"1\">20.18</td>\n                  <td data-row=\"9\" data-col=\"2\">76.2</td>\n                  <td data-row=\"9\" data-col=\"3\">4.34</td>\n                  <td data-row=\"9\" data-col=\"4\">17.6</td>\n                  <td data-row=\"9\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"9\" data-col=\"6\">67.7</td>\n                  <td data-row=\"9\" data-col=\"7\">84.7</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"1\">20.59</td>\n                  <td data-row=\"10\" data-col=\"2\">76.6</td>\n                  <td data-row=\"10\" data-col=\"3\">4.49</td>\n                  <td data-row=\"10\" data-col=\"4\">17.1</td>\n                  <td data-row=\"10\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"10\" data-col=\"6\">67.8</td>\n                  <td data-row=\"10\" data-col=\"7\">85.4</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"1\">21.00</td>\n                  <td data-row=\"11\" data-col=\"2\">77.0</td>\n                  <td data-row=\"11\" data-col=\"3\">4.65</td>\n                  <td data-row=\"11\" data-col=\"4\">16.6</td>\n                  <td data-row=\"11\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"11\" data-col=\"6\">67.9</td>\n                  <td data-row=\"11\" data-col=\"7\">86.1</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nThe `Estimate` column shows the predicted **mean** value of `lsas_post` across a range of `gad_screen` values.\n\n## 6.2 Predicted medians across `gad_screen`\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_rq <- predictions(mod_rq, newdata = newdat)\npred_rq\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_axtzevrogah63dvp6b4u = TinyTable.createTableFunctions(\"tinytable_axtzevrogah63dvp6b4u\");\n      // tinytable span after\n      window.addEventListener('load', function () { tableFns_axtzevrogah63dvp6b4u.spanCell(6, 1, 1, 7) })\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '11', j: 1 }, { i: '11', j: 2 }, { i: '11', j: 3 }, { i: '11', j: 4 }, { i: '11', j: 5 }, { i: '11', j: 6 }, { i: '11', j: 7 } ], css_id: 'tinytable_css_remnocwxslxk58efem1j',}, \n          { positions: [ { i: '6', j: 1 }, { i: '6', j: 2 }, { i: '6', j: 3 }, { i: '6', j: 4 }, { i: '6', j: 5 }, { i: '6', j: 6 }, { i: '6', j: 7 } ], css_id: 'tinytable_css_m10dvfb7lys7egkqikty',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 } ], css_id: 'tinytable_css_cjqk90sslmx06w2d1488',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_axtzevrogah63dvp6b4u.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_axtzevrogah63dvp6b4u td.tinytable_css_remnocwxslxk58efem1j, #tinytable_axtzevrogah63dvp6b4u th.tinytable_css_remnocwxslxk58efem1j {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_axtzevrogah63dvp6b4u td.tinytable_css_m10dvfb7lys7egkqikty, #tinytable_axtzevrogah63dvp6b4u th.tinytable_css_m10dvfb7lys7egkqikty { text-align: center }\n    #tinytable_axtzevrogah63dvp6b4u td.tinytable_css_cjqk90sslmx06w2d1488, #tinytable_axtzevrogah63dvp6b4u th.tinytable_css_cjqk90sslmx06w2d1488 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_axtzevrogah63dvp6b4u\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">gad_screen</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"7\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='7'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">1.00</td>\n                  <td data-row=\"1\" data-col=\"2\">62.2</td>\n                  <td data-row=\"1\" data-col=\"3\">6.97</td>\n                  <td data-row=\"1\" data-col=\"4\">8.92</td>\n                  <td data-row=\"1\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"6\">48.5</td>\n                  <td data-row=\"1\" data-col=\"7\">75.8</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">1.41</td>\n                  <td data-row=\"2\" data-col=\"2\">62.4</td>\n                  <td data-row=\"2\" data-col=\"3\">6.74</td>\n                  <td data-row=\"2\" data-col=\"4\">9.25</td>\n                  <td data-row=\"2\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"2\" data-col=\"6\">49.2</td>\n                  <td data-row=\"2\" data-col=\"7\">75.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">1.82</td>\n                  <td data-row=\"3\" data-col=\"2\">62.6</td>\n                  <td data-row=\"3\" data-col=\"3\">6.51</td>\n                  <td data-row=\"3\" data-col=\"4\">9.60</td>\n                  <td data-row=\"3\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"3\" data-col=\"6\">49.8</td>\n                  <td data-row=\"3\" data-col=\"7\">75.3</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">2.22</td>\n                  <td data-row=\"4\" data-col=\"2\">62.7</td>\n                  <td data-row=\"4\" data-col=\"3\">6.29</td>\n                  <td data-row=\"4\" data-col=\"4\">9.98</td>\n                  <td data-row=\"4\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"4\" data-col=\"6\">50.4</td>\n                  <td data-row=\"4\" data-col=\"7\">75.1</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"1\">2.63</td>\n                  <td data-row=\"5\" data-col=\"2\">62.9</td>\n                  <td data-row=\"5\" data-col=\"3\">6.06</td>\n                  <td data-row=\"5\" data-col=\"4\">10.38</td>\n                  <td data-row=\"5\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"5\" data-col=\"6\">51.0</td>\n                  <td data-row=\"5\" data-col=\"7\">74.8</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"1\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"2\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"3\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"4\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"5\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"6\">40 rows omitted</td>\n                  <td data-row=\"6\" data-col=\"7\">40 rows omitted</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"1\">19.37</td>\n                  <td data-row=\"7\" data-col=\"2\">70.5</td>\n                  <td data-row=\"7\" data-col=\"3\">5.74</td>\n                  <td data-row=\"7\" data-col=\"4\">12.28</td>\n                  <td data-row=\"7\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"7\" data-col=\"6\">59.3</td>\n                  <td data-row=\"7\" data-col=\"7\">81.8</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"1\">19.78</td>\n                  <td data-row=\"8\" data-col=\"2\">70.7</td>\n                  <td data-row=\"8\" data-col=\"3\">5.97</td>\n                  <td data-row=\"8\" data-col=\"4\">11.85</td>\n                  <td data-row=\"8\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"8\" data-col=\"6\">59.0</td>\n                  <td data-row=\"8\" data-col=\"7\">82.4</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"1\">20.18</td>\n                  <td data-row=\"9\" data-col=\"2\">70.9</td>\n                  <td data-row=\"9\" data-col=\"3\">6.19</td>\n                  <td data-row=\"9\" data-col=\"4\">11.45</td>\n                  <td data-row=\"9\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"9\" data-col=\"6\">58.8</td>\n                  <td data-row=\"9\" data-col=\"7\">83.0</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"1\">20.59</td>\n                  <td data-row=\"10\" data-col=\"2\">71.1</td>\n                  <td data-row=\"10\" data-col=\"3\">6.42</td>\n                  <td data-row=\"10\" data-col=\"4\">11.08</td>\n                  <td data-row=\"10\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"10\" data-col=\"6\">58.5</td>\n                  <td data-row=\"10\" data-col=\"7\">83.7</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"1\">21.00</td>\n                  <td data-row=\"11\" data-col=\"2\">71.3</td>\n                  <td data-row=\"11\" data-col=\"3\">6.64</td>\n                  <td data-row=\"11\" data-col=\"4\">10.73</td>\n                  <td data-row=\"11\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"11\" data-col=\"6\">58.2</td>\n                  <td data-row=\"11\" data-col=\"7\">84.3</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nThe `estimate` column shows the predicted **median** value of `lsas_post` across a range of `gad_screen` values.\n\n## 6.3 Marginal effect (slope)\n\nFor numeric predictors, contrasts correspond to **slopes**. These will be the same as the coefficient you got using the `summary()` function above.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_slopes(mod_lm)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_4lv1v0zlh6qdr69widsr = TinyTable.createTableFunctions(\"tinytable_4lv1v0zlh6qdr69widsr\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 } ], css_id: 'tinytable_css_953xnig0s6yr8u1t21p9',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 } ], css_id: 'tinytable_css_aodqjfb6kf1j0p06jr2u',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_4lv1v0zlh6qdr69widsr.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_4lv1v0zlh6qdr69widsr td.tinytable_css_953xnig0s6yr8u1t21p9, #tinytable_4lv1v0zlh6qdr69widsr th.tinytable_css_953xnig0s6yr8u1t21p9 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_4lv1v0zlh6qdr69widsr td.tinytable_css_aodqjfb6kf1j0p06jr2u, #tinytable_4lv1v0zlh6qdr69widsr th.tinytable_css_aodqjfb6kf1j0p06jr2u {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_4lv1v0zlh6qdr69widsr\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='6'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">0.971</td>\n                  <td data-row=\"1\" data-col=\"2\">0.417</td>\n                  <td data-row=\"1\" data-col=\"3\">2.33</td>\n                  <td data-row=\"1\" data-col=\"4\">0.02</td>\n                  <td data-row=\"1\" data-col=\"5\">0.153</td>\n                  <td data-row=\"1\" data-col=\"6\">1.79</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nFor quantile regression:\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_slopes(mod_rq)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_mgslozgc07153m22ele4 = TinyTable.createTableFunctions(\"tinytable_mgslozgc07153m22ele4\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 } ], css_id: 'tinytable_css_rm9xs9pgpl91g4xnjg7y',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 } ], css_id: 'tinytable_css_ebe5opbes0kbfsnt9qve',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_mgslozgc07153m22ele4.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_mgslozgc07153m22ele4 td.tinytable_css_rm9xs9pgpl91g4xnjg7y, #tinytable_mgslozgc07153m22ele4 th.tinytable_css_rm9xs9pgpl91g4xnjg7y {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_mgslozgc07153m22ele4 td.tinytable_css_ebe5opbes0kbfsnt9qve, #tinytable_mgslozgc07153m22ele4 th.tinytable_css_ebe5opbes0kbfsnt9qve {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_mgslozgc07153m22ele4\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='6'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">0.455</td>\n                  <td data-row=\"1\" data-col=\"2\">0.62</td>\n                  <td data-row=\"1\" data-col=\"3\">0.733</td>\n                  <td data-row=\"1\" data-col=\"4\">0.463</td>\n                  <td data-row=\"1\" data-col=\"5\">-0.76</td>\n                  <td data-row=\"1\" data-col=\"6\">1.67</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n# 7. Visualization\n\nWe can now visualize the relationship using the predicted values we got using the `predictions()` function earlier. Remember that these were saved using in the objects `pred_lm` and `pred_rq`\n\n## 7.1 Linear regression line with confidence interval\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(mod_lm, condition = \"gad_screen\", points = 0.4) +\n  labs(\n    x = \"GAD score at screening\",\n    y = \"LSAS post-treatment\",\n    title = \"Linear Regression: Mean LSAS vs Baseline Anxiety\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-one-numeric-predictor_files/figure-html/plot-lm-line-1.png){width=672}\n:::\n:::\n\n\n## 7.2 Median regression line with confidence interval\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(mod_rq, condition = \"gad_screen\", points = 0.4) +\n\n  labs(\n    x = \"GAD score at screening\",\n    y = \"LSAS post-treatment\",\n    title = \"Quantile Regression: Median LSAS vs Baseline Anxiety\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-one-numeric-predictor_files/figure-html/plot-rq-line-1.png){width=672}\n:::\n:::\n\n\n# 8. Modeling Non-Linear Relationships\n\nSo far, we have assumed that the relationship between baseline severity and post-treatment severity is **linear**.\n\nHowever, clinical change processes are sometimes **non-linear**. For example:\n\n- participants with very low baseline severity have limited room for improvement\n- participants with very high baseline severity may show diminishing returns\n- treatment effects may level off at the extremes\n\nTo explore this, we now examine the relationship between **baseline LSAS score** (`lsas_screen`) and **post-treatment LSAS score** (`lsas_post`).\n\nIn this section, we illustrate two common approaches to modeling non-linearity:\n\n1.  **Polynomial regression**\n2.  **Spline regression**\n\n------------------------------------------------------------------------\n\n### 8.1 Polynomial regression\n\nPolynomial regression models nonlinear relationships by adding powers of the predictor (e.g., quadratic, cubic), allowing the mean trend to deviate from straight line.\n\n#### Model formulation\n\nA quadratic polynomial model can be written as:\n$$\n\\mathbb{E}(LSAS_{post,i} \\mid lsas\\_screen_i) = \\beta_0 + \\beta_1 \\, lsas\\_screen_i + \\beta_2 \\, lsas\\_screen_i^2\n$$\n\nThis allows the relationship to be **curved** rather than straight.\n\n#### Fit a quadratic model\n\nIn R, we use the `poly()` function. Setting `raw = TRUE` makes the coefficients correspond directly to powers of the predictor.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm_poly <- lm(lsas_post ~ poly(lsas_screen, 2, raw = TRUE), data = df_clean)\nsummary(mod_lm_poly)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ poly(lsas_screen, 2, raw = TRUE), data = df_clean)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-85.060 -12.942   3.565  13.443  42.811 \n\nCoefficients:\n                                    Estimate Std. Error t value Pr(>|t|)  \n(Intercept)                       -43.518108  37.945495  -1.147   0.2531  \npoly(lsas_screen, 2, raw = TRUE)1   1.753930   0.841860   2.083   0.0387 *\npoly(lsas_screen, 2, raw = TRUE)2  -0.005122   0.004540  -1.128   0.2609  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 20.78 on 166 degrees of freedom\n  (12 observations deleted due to missingness)\nMultiple R-squared:  0.3048,\tAdjusted R-squared:  0.2964 \nF-statistic: 36.39 on 2 and 166 DF,  p-value: 7.875e-14\n```\n\n\n:::\n:::\n\n\n#### Interpretation\n\n- The **intercept** is the expected LSAS score when `lsas_screen = 0`\n- The **linear term** captures the overall trend\n- The **quadratic term** captures curvature\n\nBecause individual coefficients are difficult to interpret, we rely on **predicted values and visualization**.\n\n#### Visualizing the polynomial fit\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(\n  mod_lm_poly,\n  condition = \"lsas_screen\",\n  points = 0.4\n) + labs(\n  x = \"LSAS score at screening\",\n  y = \"LSAS post-treatment\",\n  title = \"Polynomial Regression (Quadratic Relationship)\"\n) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-one-numeric-predictor_files/figure-html/plot-poly-1.png){width=672}\n:::\n:::\n\n\n### 8.2 Spline regression\n\nPolynomial models impose a **global shape** on the data. Spline regression offers a more flexible approach by fitting the relationship **locally**, while maintaining smoothness.\n\n#### Model formulation\n\nUsing splines, the model is written as:\n$$\n\\mathbb{E}(LSAS_{post} \\mid lsas\\_screen) = \\beta_0 + f(lsas\\_screen)\n$$\nwhere $f(\\cdot)$ is a smooth function estimated from the data. In practice, splines approximate $f$ with a set of piecewise cubic polynomials that are joined at a small number of locations called “knots.” The pieces are constrained to join smoothly, typically ensuring the function and its first two derivatives are continuous across knots. This allows the curve to adapt to local patterns without imposing a single global shape.\n\n::: {.callout-tip}\n##### What is a natural cubic spline?\n\nA natural cubic spline is a cubic spline with additional boundary constraints: outside the boundary knots, the function is constrained to be linear. This stabilizes the fit near the extremes of the predictor and reduces spurious wiggles in the tails. In R, `splines::ns()` can be used to constructs a natural cubic spline. You can control flexibility via either `df` or `knots` (internal knot locations). If `knots` is supplied, `df` is ignored.\n\n- `df`: controls flexibility, e.g. how many knots that are used to construct the spline. With `df` and no `knots`, `ns()` places internal knots at equally spaced quantiles of the predictor within the boundary knots (by default the min and max).\n- `knots`: Numeric vector of internal knot locations (on the predictor’s scale). When provided, `ns()` uses them exactly and ignores `df`. Use `Boundary.knots` to change the default min/max if needed. \n\nSo for `ns(df_clean$lsas_screen, df = 4)` we construct 4 columns, i.e. the model estimates four spline coefficients plus an intercept. This corresponds to a natural cubic spline with 2 boundary knots and 3 knots in-between.\n:::\n\n#### Fit a spline model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(splines)\n\nmod_lm_spline <- lm(\n  lsas_post ~ ns(lsas_screen, df = 4),\n  data = df_clean\n)\nsummary(mod_lm_spline)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ ns(lsas_screen, df = 4), data = df_clean)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-82.486 -12.822   2.455  13.112  45.024 \n\nCoefficients:\n                         Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                37.322      6.629   5.630 7.66e-08 ***\nns(lsas_screen, df = 4)1   19.444      7.546   2.577   0.0109 *  \nns(lsas_screen, df = 4)2   47.252      8.099   5.834 2.81e-08 ***\nns(lsas_screen, df = 4)3   82.116     16.089   5.104 9.13e-07 ***\nns(lsas_screen, df = 4)4   43.253      9.620   4.496 1.30e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 20.62 on 164 degrees of freedom\n  (12 observations deleted due to missingness)\nMultiple R-squared:  0.324,\tAdjusted R-squared:  0.3075 \nF-statistic: 19.65 on 4 and 164 DF,  p-value: 3.146e-13\n```\n\n\n:::\n:::\n\n\nAs with polynomials, spline coefficients are **not interpreted individually**.\n\n#### Visualizing the spline fit\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknots <- ns(df_clean$lsas_screen, df = 4) |> attr(\"knots\")\n\nplot_predictions(\n  mod_lm_spline,\n  condition = \"lsas_screen\",\n  points = 0.4\n) +\n  geom_vline(xintercept = knots, linetype = \"dashed\") +\n  labs(\n    x = \"LSAS score at screening\",\n    y = \"LSAS post-treatment\",\n    title = \"Spline Regression (Natural Cubic Spline)\",\n    caption = \"Vertical dashed lines show knots placement\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-one-numeric-predictor_files/figure-html/plot-spline-1.png){width=672}\n:::\n:::\n\n\n### 8.3 Comparing linear and non-linear fits\n\nFinally, we compare:\n\n- a linear model\n- a quadratic polynomial model\n- a spline model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm_linear <- lm(lsas_post ~ lsas_screen, data = df_clean)\n\n# Grid for lsas_screen\nnewdat_lsas <- datagrid(\n  newdata = df_clean,\n  lsas_screen = seq(\n    min(df_clean$lsas_screen, na.rm = TRUE),\n    max(df_clean$lsas_screen, na.rm = TRUE),\n    length.out = 100\n  )\n)\n\n# Get predictions from each model\npred_linear <- predictions(mod_lm_linear, newdata = newdat_lsas) |>\n  mutate(model = \"Linear\")\npred_poly <- predictions(mod_lm_poly, newdata = newdat_lsas) |>\n  mutate(model = \"Quadratic\")\npred_spline <- predictions(mod_lm_spline, newdata = newdat_lsas) |>\n  mutate(model = \"Natural Cubic Spline\")\n# Combine into one data frame\npred_both <- bind_rows(\n  pred_linear,\n  pred_poly,\n  pred_spline\n)\n\n# Plot\nggplot(df_clean, aes(x = lsas_screen, y = lsas_post)) +\n  geom_point(alpha = 0.4) +\n  geom_line(data = pred_both, aes(y = estimate, color = model), linewidth = 1) +\n  labs(\n    x = \"LSAS score at screening\",\n    y = \"LSAS post-treatment\",\n    title = \"Linear vs Quadratic vs Spline Fits\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 12 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](regression-one-numeric-predictor_files/figure-html/compare-fits-1.png){width=672}\n:::\n:::\n\n\nWe can also formally compare the models.\n\n::: {.cell}\n\n```{.r .cell-code}\n# only for \"nested\" models\nanova(\n  mod_lm_linear,\n  mod_lm_poly,\n  mod_lm_spline\n)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| Res.Df|      RSS| Df| Sum of Sq|        F|    Pr(>F)|\n|------:|--------:|--:|---------:|--------:|---------:|\n|    167| 72241.45| NA|        NA|       NA|        NA|\n|    166| 71691.76|  1|   549.692| 1.293153| 0.2571265|\n|    164| 69712.93|  2|  1978.830| 2.327603| 0.1007432|\n\n</div>\n:::\n\n```{.r .cell-code}\nperformance::compare_performance(\n  mod_lm_linear,\n  mod_lm_poly,\n  mod_lm_spline\n)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|Name          |Model |      AIC|    AIC_wt|     AICc|   AICc_wt|      BIC|    BIC_wt|        R2| R2_adjusted|     RMSE|    Sigma|\n|:-------------|:-----|--------:|---------:|--------:|---------:|--------:|---------:|---------:|-----------:|--------:|--------:|\n|mod_lm_linear |lm    | 1509.381| 0.3687164| 1509.527| 0.3989722| 1518.771| 0.8651144| 0.2994469|   0.2952520| 20.67521| 20.79864|\n|mod_lm_poly   |lm    | 1510.090| 0.2586446| 1510.334| 0.2664256| 1522.610| 0.1268924| 0.3047775|   0.2964013| 20.59640| 20.78168|\n|mod_lm_spline |lm    | 1509.360| 0.3726391| 1509.879| 0.3346022| 1528.140| 0.0079932| 0.3239670|   0.3074783| 20.31016| 20.61744|\n\n</div>\n:::\n:::\n\n\nWhen comparing, the differences between the non-linear fits and the straight line are small; non-linearities could arguably be ignored in modeling.\n\n# Summary\n\nIn this chapter you learned:\n\n- how numeric predictors enter regression models\n- how intercepts and slopes are interpreted\n- how linear regression models **mean trends**\n- how quantile regression models **quantile trends**\n- how to compute predictions across a range of predictor values\n- how to estimate and interpret marginal effects (slopes)\n- how to visualize regression lines with confidence intervals\n- how to allow for non-linear relationships\n\nThis chapter completes the foundation for regression models with a **single predictor**. In the next chapter, we will combine **multiple predictors** in the same model.\n",
    "supporting": [
      "regression-one-numeric-predictor_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
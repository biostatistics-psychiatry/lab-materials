{
  "hash": "e4a19994b6308065a9897abdba5a2925",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Chapter 6: Regression with One Binary and One Numeric Predictor\"\nformat: \n   html:\n     df-print: kable\ntoc: true\ntoc-depth: 3\n---\n\n# Introduction\n\nIn the previous chapter, we studied regression models with **two binary predictors**, and learned how to distinguish between:\n\n- **additive models** (no interaction)\n- **interaction models** (effect modification)\n\nIn this chapter, we extend these ideas to a model with:\n\n- one **binary** predictor: `trt` (therapist-guided vs waitlist)\n- one **numeric** predictor: `phq9_screen` (baseline depression severity)\n\nThis allows us to introduce conditional effects when the moderator is numeric, and to distinguish between:\n\n- **parallel slopes** (no interaction): the treatment effect is constant across `phq9_screen`\n- **effect modification** (interaction): the treatment effect varies with `phq9_screen`\n\nYou will learn:\n\n- how to interpret models with one binary and one numeric predictor\n- how conditional treatment effects vary across values of a numeric variable\n- how interactions change interpretation\n- how to estimate conditional and marginal effects using `marginaleffects`\n- how to visualize interactions with predicted values\n\n# 1. Packages and Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(quantreg)\nlibrary(marginaleffects)\nlibrary(here)\n```\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\n## Load data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_clean <- read_csv2(here(\"data\", \"steps_clean.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ Using \"','\" as decimal and \"'.'\" as grouping mark. Use `read_delim()` for more control.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 181 Columns: 37\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \";\"\nchr  (1): trt\ndbl (34): id, lsas_screen, gad_screen, phq9_screen, bbq_screen, scs_screen, ...\nnum  (2): dmrsodf_screen, dmrsodf_post\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\nAs before, we use treatment group as our binary predictor. We subset the data to include only participants in the therapist-guided and waitlist conditions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_red <- filter(df_clean, trt %in% c(\"therapist-guided\", \"waitlist\"))\ndf_red <- df_red |> mutate(\n  trt = factor(trt, levels = c(\"waitlist\", \"therapist-guided\"))\n)\n```\n:::\n\n\nThe other predictor will be baseline depression severity measured continuously using `phq9_screen`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(df_red$phq9_screen)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   1.00    7.00    9.00    9.85   13.00   19.00 \n```\n\n\n:::\n:::\n\n\n# 2. One Binary and One Numeric Predictor without Interaction (Additive Model)\n\nWe begin with a model that includes both predictors **without** an interaction.\n\n## 2.1 Model formula\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlsas_post ~ trt + phq9_screen\n```\n:::\n\n\nThis corresponds to the linear regression model for the conditional mean:\n\n$$\n\\begin{aligned}\n\\mathbb{E}(LSAS_{post,i} \\,\\mid\\, trt_i,\\; phq9\\_screen_i) =& \\beta_0 + \\\\\n& \\beta_1\\, \\mathbf{1}\\{\\text{trt}_i = \\text{therapist-guided}\\} + \\\\\n& \\beta_2\\, phq9\\_screen_i\n\\end{aligned}\n$$\n\nWhere:\n\n- $\\beta_0$: mean outcome when `trt = waitlist` and `phq9_screen = 0`\n- $\\beta_1$: conditional treatment effect holding PHQ-9 constant\n- $\\beta_2$: conditional effect of PHQ-9 holding treatment constant\n\n::: {.callout-tip}\n### Interpretation\n\nIn this model:\n\n- the treatment effect is assumed to be **the same at all values of PHQ-9**\n- the PHQ-9 slope is assumed to be **the same in both treatment groups**\n\nThis is an **additive model** (parallel slopes).\n:::\n\n\n# 3. Linear Regression without Interaction\n\n## 3.1 Fit the model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm_add <- lm(lsas_post ~ trt + phq9_screen, data = df_red)\nsummary(mod_lm_add)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ trt + phq9_screen, data = df_red)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-65.918 -13.561  -0.148  12.947  62.865 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)          63.3772     5.9399  10.670  < 2e-16 ***\ntrttherapist-guided -19.3976     4.4906  -4.320 3.46e-05 ***\nphq9_screen           1.4617     0.4919   2.972  0.00364 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 23.55 on 109 degrees of freedom\n  (8 observations deleted due to missingness)\nMultiple R-squared:  0.2229,\tAdjusted R-squared:  0.2086 \nF-statistic: 15.63 on 2 and 109 DF,  p-value: 1.074e-06\n```\n\n\n:::\n:::\n\n\n::: {.callout-tip}\n### Interpretation\n\n- **Intercept**: mean LSAS at post when `trt = waitlist` and `phq9_screen = 0`\\\n    (note: `phq9_screen = 0` may be outside the range of the data, so the intercept is often not directly meaningful)\n- **trt coefficient**: treatment effect adjusted for PHQ-9\n- **phq9_screen coefficient**: association between baseline depression and post-treatment LSAS, adjusted for treatment\n:::\n\n\n## 3.2 Predicted means for each treatment group (averaged over PHQ-9)\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_predictions(mod_lm_add, by = \"trt\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_bqzbyksili17stknkgwu = TinyTable.createTableFunctions(\"tinytable_bqzbyksili17stknkgwu\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '2', j: 1 }, { i: '2', j: 2 }, { i: '2', j: 3 }, { i: '2', j: 4 }, { i: '2', j: 5 }, { i: '2', j: 6 }, { i: '2', j: 7 } ], css_id: 'tinytable_css_qgwuz2l0qibh0tfe31cl',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 } ], css_id: 'tinytable_css_xl2ou69sk4kdqh75e737',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_bqzbyksili17stknkgwu.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_bqzbyksili17stknkgwu td.tinytable_css_qgwuz2l0qibh0tfe31cl, #tinytable_bqzbyksili17stknkgwu th.tinytable_css_qgwuz2l0qibh0tfe31cl {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_bqzbyksili17stknkgwu td.tinytable_css_xl2ou69sk4kdqh75e737, #tinytable_bqzbyksili17stknkgwu th.tinytable_css_xl2ou69sk4kdqh75e737 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_bqzbyksili17stknkgwu\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">trt</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"7\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='7'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">waitlist</td>\n                  <td data-row=\"1\" data-col=\"2\">78.4</td>\n                  <td data-row=\"1\" data-col=\"3\">3.09</td>\n                  <td data-row=\"1\" data-col=\"4\">25.4</td>\n                  <td data-row=\"1\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"6\">72.4</td>\n                  <td data-row=\"1\" data-col=\"7\">84.5</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">therapist-guided</td>\n                  <td data-row=\"2\" data-col=\"2\">57.4</td>\n                  <td data-row=\"2\" data-col=\"3\">3.21</td>\n                  <td data-row=\"2\" data-col=\"4\">17.9</td>\n                  <td data-row=\"2\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"2\" data-col=\"6\">51.1</td>\n                  <td data-row=\"2\" data-col=\"7\">63.6</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n## 3.3 Treatment effect as a conditional contrast\n\nBecause there is no interaction, the conditional treatment effect is the same for all PHQ-9 values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(mod_lm_add,\n  variables = \"trt\",\n  by = \"phq9_screen\"\n)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_z0elfsbun4lb1bcocgsz = TinyTable.createTableFunctions(\"tinytable_z0elfsbun4lb1bcocgsz\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '19', j: 1 }, { i: '19', j: 2 }, { i: '19', j: 3 }, { i: '19', j: 4 }, { i: '19', j: 5 }, { i: '19', j: 6 }, { i: '19', j: 7 } ], css_id: 'tinytable_css_avxkqt0bhq4b5obdelkn',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 } ], css_id: 'tinytable_css_oocpvnwtag3m6ikrotj1',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_z0elfsbun4lb1bcocgsz.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_z0elfsbun4lb1bcocgsz td.tinytable_css_avxkqt0bhq4b5obdelkn, #tinytable_z0elfsbun4lb1bcocgsz th.tinytable_css_avxkqt0bhq4b5obdelkn {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_z0elfsbun4lb1bcocgsz td.tinytable_css_oocpvnwtag3m6ikrotj1, #tinytable_z0elfsbun4lb1bcocgsz th.tinytable_css_oocpvnwtag3m6ikrotj1 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_z0elfsbun4lb1bcocgsz\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">phq9_screen</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"7\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='7'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">1</td>\n                  <td data-row=\"1\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"1\" data-col=\"3\">4.49</td>\n                  <td data-row=\"1\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"1\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"1\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">2</td>\n                  <td data-row=\"2\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"2\" data-col=\"3\">4.49</td>\n                  <td data-row=\"2\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"2\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"2\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"2\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">3</td>\n                  <td data-row=\"3\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"3\" data-col=\"3\">4.49</td>\n                  <td data-row=\"3\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"3\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"3\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"3\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">4</td>\n                  <td data-row=\"4\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"4\" data-col=\"3\">4.49</td>\n                  <td data-row=\"4\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"4\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"4\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"4\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"1\">5</td>\n                  <td data-row=\"5\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"5\" data-col=\"3\">4.49</td>\n                  <td data-row=\"5\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"5\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"5\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"5\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"1\">6</td>\n                  <td data-row=\"6\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"6\" data-col=\"3\">4.49</td>\n                  <td data-row=\"6\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"6\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"6\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"6\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"1\">7</td>\n                  <td data-row=\"7\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"7\" data-col=\"3\">4.49</td>\n                  <td data-row=\"7\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"7\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"7\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"7\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"1\">8</td>\n                  <td data-row=\"8\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"8\" data-col=\"3\">4.49</td>\n                  <td data-row=\"8\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"8\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"8\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"8\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"1\">9</td>\n                  <td data-row=\"9\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"9\" data-col=\"3\">4.49</td>\n                  <td data-row=\"9\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"9\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"9\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"9\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"1\">10</td>\n                  <td data-row=\"10\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"10\" data-col=\"3\">4.49</td>\n                  <td data-row=\"10\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"10\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"10\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"10\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"1\">11</td>\n                  <td data-row=\"11\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"11\" data-col=\"3\">4.49</td>\n                  <td data-row=\"11\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"11\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"11\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"11\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"12\" data-col=\"1\">12</td>\n                  <td data-row=\"12\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"12\" data-col=\"3\">4.49</td>\n                  <td data-row=\"12\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"12\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"12\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"12\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"13\" data-col=\"1\">13</td>\n                  <td data-row=\"13\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"13\" data-col=\"3\">4.49</td>\n                  <td data-row=\"13\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"13\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"13\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"13\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"14\" data-col=\"1\">14</td>\n                  <td data-row=\"14\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"14\" data-col=\"3\">4.49</td>\n                  <td data-row=\"14\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"14\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"14\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"14\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"15\" data-col=\"1\">15</td>\n                  <td data-row=\"15\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"15\" data-col=\"3\">4.49</td>\n                  <td data-row=\"15\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"15\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"15\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"15\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"16\" data-col=\"1\">16</td>\n                  <td data-row=\"16\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"16\" data-col=\"3\">4.49</td>\n                  <td data-row=\"16\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"16\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"16\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"16\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"17\" data-col=\"1\">17</td>\n                  <td data-row=\"17\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"17\" data-col=\"3\">4.49</td>\n                  <td data-row=\"17\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"17\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"17\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"17\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"18\" data-col=\"1\">18</td>\n                  <td data-row=\"18\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"18\" data-col=\"3\">4.49</td>\n                  <td data-row=\"18\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"18\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"18\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"18\" data-col=\"7\">-10.6</td>\n                </tr>\n                <tr>\n                  <td data-row=\"19\" data-col=\"1\">19</td>\n                  <td data-row=\"19\" data-col=\"2\">-19.4</td>\n                  <td data-row=\"19\" data-col=\"3\">4.49</td>\n                  <td data-row=\"19\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"19\" data-col=\"5\">&lt;0.001</td>\n                  <td data-row=\"19\" data-col=\"6\">-28.2</td>\n                  <td data-row=\"19\" data-col=\"7\">-10.6</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n# 4. Adding an Interaction\n\nNow we allow the treatment effect to differ depending on baseline depression severity.\n\n## 4.1 Model formula with interaction\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlsas_post ~ trt * phq9_screen\n```\n:::\n\n\nWhich expands to the conditional mean:\n\n$$\n\\begin{aligned}\n\\mathbb{E}(LSAS_{post,i} \\,\\mid\\, trt_i,\\; phq9\\_screen_i) =& \\beta_0 + \\\\\n& \\beta_1\\, \\mathbf{1}\\{\\text{trt}_i = \\text{therapist-guided}\\} + \\\\\n& \\beta_2\\, phq9\\_screen_i + \\\\\n& \\beta_3\\, \\mathbf{1}\\{\\text{trt}_i = \\text{therapist-guided}\\} \\times phq9\\_screen_i\n\\end{aligned}\n$$\n\n- $\\beta_3$ is the **interaction term**, it captures how the treatment effect changes as PHQ-9 increases\n\nWe now allow the treatment effect to differ **depending on baseline depression**, rather than remaining constant across PHQ-9 values.\n\n# 5. Linear Regression with Interaction\n\n## 5.1 Fit the interaction model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm_int <- lm(lsas_post ~ trt * phq9_screen, data = df_red)\nsummary(mod_lm_int)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ trt * phq9_screen, data = df_red)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-65.585 -13.229  -0.181  13.429  62.900 \n\nCoefficients:\n                                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                      65.4083     7.5650   8.646 5.45e-14 ***\ntrttherapist-guided             -23.5820    10.5995  -2.225   0.0282 *  \nphq9_screen                       1.2647     0.6691   1.890   0.0614 .  \ntrttherapist-guided:phq9_screen   0.4324     0.9913   0.436   0.6636    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 23.64 on 108 degrees of freedom\n  (8 observations deleted due to missingness)\nMultiple R-squared:  0.2243,\tAdjusted R-squared:  0.2027 \nF-statistic: 10.41 on 3 and 108 DF,  p-value: 4.513e-06\n```\n\n\n:::\n:::\n\n\n::: {.callout-tip}\n### Interpretation\n\n- The treatment effect is **conditional on PHQ-9**\n- Main effects are interpreted **at the reference level** of the other variable:\n    - the `trt` coefficient is the treatment effect when `phq9_screen = 0`\n    - the `phq9_screen` coefficient is the PHQ-9 slope in the waitlist group (reference level)\n- The interaction coefficient represents **how much the treatment effect changes for a one-unit increase in PHQ-9**. For example, a negative interaction means the treatment effect becomes more negative (larger improvement) at higher PHQ-9.\n:::\n\n\n## 5.2 Conditional treatment effects at selected PHQ-9 values\n\nA simple way to interpret the interaction is to estimate the treatment effect at several meaningful PHQ-9 values (e.g., low, medium, high).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphq_vals <- quantile(\n  df_red$phq9_screen,\n  probs = c(.25, .50, .75),\n  na.rm = TRUE\n)\nphq_vals\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n25% 50% 75% \n  7   9  13 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\n  mod_lm_int,\n  variables = \"trt\",\n  newdata = datagrid(\n    phq9_screen = phq_vals\n  ),\n  by = \"phq9_screen\"\n)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_61i6xq1k2z4mb2l7k5tq = TinyTable.createTableFunctions(\"tinytable_61i6xq1k2z4mb2l7k5tq\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '3', j: 1 }, { i: '3', j: 2 }, { i: '3', j: 3 }, { i: '3', j: 4 }, { i: '3', j: 5 }, { i: '3', j: 6 }, { i: '3', j: 7 } ], css_id: 'tinytable_css_wl4nj706xth135970e5j',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 } ], css_id: 'tinytable_css_l41nnce0raypuefft1n2',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_61i6xq1k2z4mb2l7k5tq.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_61i6xq1k2z4mb2l7k5tq td.tinytable_css_wl4nj706xth135970e5j, #tinytable_61i6xq1k2z4mb2l7k5tq th.tinytable_css_wl4nj706xth135970e5j {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_61i6xq1k2z4mb2l7k5tq td.tinytable_css_l41nnce0raypuefft1n2, #tinytable_61i6xq1k2z4mb2l7k5tq th.tinytable_css_l41nnce0raypuefft1n2 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_61i6xq1k2z4mb2l7k5tq\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">phq9_screen</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"7\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='7'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">7</td>\n                  <td data-row=\"1\" data-col=\"2\">-20.6</td>\n                  <td data-row=\"1\" data-col=\"3\">5.23</td>\n                  <td data-row=\"1\" data-col=\"4\">-3.93</td>\n                  <td data-row=\"1\" data-col=\"5\">&lt; 0.001</td>\n                  <td data-row=\"1\" data-col=\"6\">-30.8</td>\n                  <td data-row=\"1\" data-col=\"7\">-10.30</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">9</td>\n                  <td data-row=\"2\" data-col=\"2\">-19.7</td>\n                  <td data-row=\"2\" data-col=\"3\">4.56</td>\n                  <td data-row=\"2\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"2\" data-col=\"5\">&lt; 0.001</td>\n                  <td data-row=\"2\" data-col=\"6\">-28.6</td>\n                  <td data-row=\"2\" data-col=\"7\">-10.76</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">13</td>\n                  <td data-row=\"3\" data-col=\"2\">-18.0</td>\n                  <td data-row=\"3\" data-col=\"3\">5.58</td>\n                  <td data-row=\"3\" data-col=\"4\">-3.22</td>\n                  <td data-row=\"3\" data-col=\"5\">0.00129</td>\n                  <td data-row=\"3\" data-col=\"6\">-28.9</td>\n                  <td data-row=\"3\" data-col=\"7\">-7.02</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n::: {.callout-tip}\n### Interpretation\nThese estimates answer: What is the treatment effect at low, medium, and high baseline depression?\n:::\n\n## 5.3 Marginal treatment effect\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\n  mod_lm_int,\n  variables = \"trt\"\n)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_fq99h0iwtot79tvye3q2 = TinyTable.createTableFunctions(\"tinytable_fq99h0iwtot79tvye3q2\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 } ], css_id: 'tinytable_css_dvcrd916vga5nxt29tzp',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 } ], css_id: 'tinytable_css_740oaodlryzjh8alltni',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_fq99h0iwtot79tvye3q2.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_fq99h0iwtot79tvye3q2 td.tinytable_css_dvcrd916vga5nxt29tzp, #tinytable_fq99h0iwtot79tvye3q2 th.tinytable_css_dvcrd916vga5nxt29tzp {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_fq99h0iwtot79tvye3q2 td.tinytable_css_740oaodlryzjh8alltni, #tinytable_fq99h0iwtot79tvye3q2 th.tinytable_css_740oaodlryzjh8alltni {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_fq99h0iwtot79tvye3q2\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='6'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">-19.4</td>\n                  <td data-row=\"1\" data-col=\"2\">4.51</td>\n                  <td data-row=\"1\" data-col=\"3\">-4.3</td>\n                  <td data-row=\"1\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"5\">-28.2</td>\n                  <td data-row=\"1\" data-col=\"6\">-10.5</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nThis is the **marginal (population-average) treatment effect**, obtained by averaging the conditional treatment effects over the observed distribution of PHQ-9 values in the sample.\n\n# 6. Quantile Regression with One Binary and One Numeric Predictor\n\nNow let's do the same thing with quantile regression (median regression).\n\n## 6.1 Additive model (median differences)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rq_add <- rq(\n  lsas_post ~ trt + phq9_screen,\n  tau = 0.5,\n  data = df_red\n)\nsummary(mod_rq_add)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall: rq(formula = lsas_post ~ trt + phq9_screen, tau = 0.5, data = df_red)\n\ntau: [1] 0.5\n\nCoefficients:\n                    coefficients lower bd  upper bd \n(Intercept)          64.66667     57.08606  77.29887\ntrttherapist-guided -22.75000    -29.61235 -19.19895\nphq9_screen           1.41667      0.04756   3.42108\n```\n\n\n:::\n:::\n\n\n## 6.2 Interaction model (median differences)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rq_int <- rq(\n  lsas_post ~ trt * phq9_screen,\n  tau = 0.5,\n  data = df_red\n)\nsummary(mod_rq_int)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall: rq(formula = lsas_post ~ trt * phq9_screen, tau = 0.5, data = df_red)\n\ntau: [1] 0.5\n\nCoefficients:\n                                coefficients lower bd  upper bd \n(Intercept)                      62.00000     44.25040  79.43182\ntrttherapist-guided             -20.08333    -40.19799  -9.25694\nphq9_screen                       1.75000     -0.28541   3.80067\ntrttherapist-guided:phq9_screen  -0.33333     -2.42512   2.24221\n```\n\n\n:::\n:::\n\n\n## 6.3 Conditional median treatment effects at selected PHQ-9 values\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\n  mod_rq_int,\n  variables = \"trt\",\n  newdata = datagrid(\n    phq9_screen = phq_vals\n  ),\n  by = \"phq9_screen\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: 2 non-positive fis\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_md11yek53gtw4nveqjzk = TinyTable.createTableFunctions(\"tinytable_md11yek53gtw4nveqjzk\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '3', j: 1 }, { i: '3', j: 2 }, { i: '3', j: 3 }, { i: '3', j: 4 }, { i: '3', j: 5 }, { i: '3', j: 6 }, { i: '3', j: 7 } ], css_id: 'tinytable_css_235c7lgxj0alb2dfujgh',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 } ], css_id: 'tinytable_css_yl36orgqvf93ic7qer8t',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_md11yek53gtw4nveqjzk.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_md11yek53gtw4nveqjzk td.tinytable_css_235c7lgxj0alb2dfujgh, #tinytable_md11yek53gtw4nveqjzk th.tinytable_css_235c7lgxj0alb2dfujgh {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_md11yek53gtw4nveqjzk td.tinytable_css_yl36orgqvf93ic7qer8t, #tinytable_md11yek53gtw4nveqjzk th.tinytable_css_yl36orgqvf93ic7qer8t {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_md11yek53gtw4nveqjzk\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">phq9_screen</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"7\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='7'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">7</td>\n                  <td data-row=\"1\" data-col=\"2\">-22.4</td>\n                  <td data-row=\"1\" data-col=\"3\">4.71</td>\n                  <td data-row=\"1\" data-col=\"4\">-4.75</td>\n                  <td data-row=\"1\" data-col=\"5\">&lt; 0.001</td>\n                  <td data-row=\"1\" data-col=\"6\">-31.7</td>\n                  <td data-row=\"1\" data-col=\"7\">-13.18</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">9</td>\n                  <td data-row=\"2\" data-col=\"2\">-23.1</td>\n                  <td data-row=\"2\" data-col=\"3\">4.71</td>\n                  <td data-row=\"2\" data-col=\"4\">-4.90</td>\n                  <td data-row=\"2\" data-col=\"5\">&lt; 0.001</td>\n                  <td data-row=\"2\" data-col=\"6\">-32.3</td>\n                  <td data-row=\"2\" data-col=\"7\">-13.85</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">13</td>\n                  <td data-row=\"3\" data-col=\"2\">-24.4</td>\n                  <td data-row=\"3\" data-col=\"3\">7.67</td>\n                  <td data-row=\"3\" data-col=\"4\">-3.18</td>\n                  <td data-row=\"3\" data-col=\"5\">0.00146</td>\n                  <td data-row=\"3\" data-col=\"6\">-39.4</td>\n                  <td data-row=\"3\" data-col=\"7\">-9.38</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n## 6.4 Marginal median treatment effect\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\n  mod_rq_int,\n  variables = \"trt\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: 2 non-positive fis\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_dawmw5gcpvehwear8cct = TinyTable.createTableFunctions(\"tinytable_dawmw5gcpvehwear8cct\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 } ], css_id: 'tinytable_css_wifj54lw9nf0vv2dd7bo',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 } ], css_id: 'tinytable_css_npi6hb1wgo6unlf0rr2f',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_dawmw5gcpvehwear8cct.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_dawmw5gcpvehwear8cct td.tinytable_css_wifj54lw9nf0vv2dd7bo, #tinytable_dawmw5gcpvehwear8cct th.tinytable_css_wifj54lw9nf0vv2dd7bo {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_dawmw5gcpvehwear8cct td.tinytable_css_npi6hb1wgo6unlf0rr2f, #tinytable_dawmw5gcpvehwear8cct th.tinytable_css_npi6hb1wgo6unlf0rr2f {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_dawmw5gcpvehwear8cct\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='6'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">-23.3</td>\n                  <td data-row=\"1\" data-col=\"2\">5.03</td>\n                  <td data-row=\"1\" data-col=\"3\">-4.63</td>\n                  <td data-row=\"1\" data-col=\"4\">&lt;0.001</td>\n                  <td data-row=\"1\" data-col=\"5\">-33.2</td>\n                  <td data-row=\"1\" data-col=\"6\">-13.5</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n# 7. Visualization\n\nTo visualize conditional effects when the moderator is numeric, it is useful to plot predicted values as a function of `phq9_screen`, separately by treatment group.\n\n## 7.1 Predicted means across PHQ-9 (additive model)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(mod_lm_add, by = c(\"phq9_screen\", \"trt\")) +\n  labs(\n    x = \"PHQ-9 at screening\",\n    y = \"Estimated Mean LSAS (95% CI)\",\n    color = \"Treatment group\",\n    fill = \"Treatment group\",\n    title = \"Additive Model: Parallel Slopes (No Interaction)\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-binary-and-numeric-predictors_files/figure-html/plot-additive-1.png){width=672}\n:::\n:::\n\n\nIn the additive model, the lines are parallel: the difference between treatment groups is constant across PHQ-9.\n\n## 7.2 Predicted means across PHQ-9 (interaction model)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(mod_lm_int, by = c(\"phq9_screen\", \"trt\")) +\n  labs(\n    x = \"PHQ-9 at screening\",\n    y = \"Estimated Mean LSAS (95% CI)\",\n    color = \"Treatment group\",\n    fill = \"Treatment group\",\n    title = \"Linear Interaction Model: Treatment Effect Varies with PHQ-9\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-binary-and-numeric-predictors_files/figure-html/plot-interaction-1.png){width=672}\n:::\n:::\n\n\nIf the lines are not parallel, the treatment effect depends on baseline depression severity. \n\n## 7.3 Visualizing the conditional treatment effect across PHQ-9\n\nInstead of plotting predicted means, we can directly plot the estimated treatment effect as a function of PHQ-9, which makes it easier to gauge how much the treatment effect varies linearly with baseline PHQ-9 scores.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_comparisons(\n  mod_lm_int,\n  variables = \"trt\",\n  by = \"phq9_screen\"\n) +\n  geom_hline(yintercept = 0, linetype = \"dashed\") +\n  labs(\n    x = \"PHQ-9 at screening\",\n    y = \"Estimated Treatment Effect (95% CI)\",\n    title = \"Conditional Treatment Effect Across Baseline Depression\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-binary-and-numeric-predictors_files/figure-html/plot-conditional-treatment-curve-1.png){width=672}\n:::\n:::\n\n\n## 7.4 Visualizing conditional treatment effects at three PHQ-9 levels\n\nWe can also calculate the treatment effect at low, medium, and high baseline depression by estimating the treatment effect at three values of `phq9_screen` (here: the 25th, 50th, and 75th percentiles).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncmp_3 <- avg_comparisons(\n  mod_lm_int,\n  variables = \"trt\",\n  by = \"phq9_screen\",\n  # we can use functions with datagrid\n  newdata = datagrid(phq9_screen = \\(x) quantile(x, probs = c(.25, .50, .75)))\n)\ncmp_3\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_z6km1sqdlxg77zzaq40f = TinyTable.createTableFunctions(\"tinytable_z6km1sqdlxg77zzaq40f\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '3', j: 1 }, { i: '3', j: 2 }, { i: '3', j: 3 }, { i: '3', j: 4 }, { i: '3', j: 5 }, { i: '3', j: 6 }, { i: '3', j: 7 } ], css_id: 'tinytable_css_lkaq3hjzxz1o710xc7b1',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 } ], css_id: 'tinytable_css_ed1a4vzd4a5zheoj9gaq',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_z6km1sqdlxg77zzaq40f.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_z6km1sqdlxg77zzaq40f td.tinytable_css_lkaq3hjzxz1o710xc7b1, #tinytable_z6km1sqdlxg77zzaq40f th.tinytable_css_lkaq3hjzxz1o710xc7b1 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_z6km1sqdlxg77zzaq40f td.tinytable_css_ed1a4vzd4a5zheoj9gaq, #tinytable_z6km1sqdlxg77zzaq40f th.tinytable_css_ed1a4vzd4a5zheoj9gaq {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_z6km1sqdlxg77zzaq40f\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">phq9_screen</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Std. Error</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">z</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"6\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"7\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='7'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">6.75</td>\n                  <td data-row=\"1\" data-col=\"2\">-20.7</td>\n                  <td data-row=\"1\" data-col=\"3\">5.36</td>\n                  <td data-row=\"1\" data-col=\"4\">-3.85</td>\n                  <td data-row=\"1\" data-col=\"5\">&lt; 0.001</td>\n                  <td data-row=\"1\" data-col=\"6\">-31.2</td>\n                  <td data-row=\"1\" data-col=\"7\">-10.16</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">9.00</td>\n                  <td data-row=\"2\" data-col=\"2\">-19.7</td>\n                  <td data-row=\"2\" data-col=\"3\">4.56</td>\n                  <td data-row=\"2\" data-col=\"4\">-4.32</td>\n                  <td data-row=\"2\" data-col=\"5\">&lt; 0.001</td>\n                  <td data-row=\"2\" data-col=\"6\">-28.6</td>\n                  <td data-row=\"2\" data-col=\"7\">-10.76</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">13.00</td>\n                  <td data-row=\"3\" data-col=\"2\">-18.0</td>\n                  <td data-row=\"3\" data-col=\"3\">5.58</td>\n                  <td data-row=\"3\" data-col=\"4\">-3.22</td>\n                  <td data-row=\"3\" data-col=\"5\">0.00129</td>\n                  <td data-row=\"3\" data-col=\"6\">-28.9</td>\n                  <td data-row=\"3\" data-col=\"7\">-7.02</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n## 7.5 Non-linear interaction (Spline)\nSo far it does not seem like there is a substantial effect of baseline PHQ-9 scores on the treatment effect. However, it is possible that the effect varies non-linearly. We can investigate this by modeling PHQ-9 scores using a natural cubic spline.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(splines)\nlibrary(patchwork)\n\n# Fit spline regression\nmod_lm_int_spline <- lm(\n  lsas_post ~ trt * ns(phq9_screen, df = 4),\n  data = df_red\n)\n\n# Plot predicted outcomes\np_spline_trend <- plot_predictions(\n  mod_lm_int_spline,\n  by = c(\"phq9_screen\", \"trt\")\n) +\n  geom_rug(\n    data = df_red,\n    aes(x = phq9_screen, y = lsas_post),\n    alpha = 0.25, position = \"jitter\", sides = \"b\"\n  ) +\n  geom_point(\n    data = df_red,\n    aes(phq9_screen, lsas_post, group = trt, color = trt),\n    alpha = 0.5\n  ) +\n  labs(\n    x = \"PHQ-9 at screening\",\n    y = \"Estimated Mean LSAS (95% CI)\",\n    color = \"Treatment group\",\n    fill = \"Treatment group\",\n    title = \"Predicted Outcomes\"\n  ) +\n  theme_minimal()\n\n# Plot treatment effects\np_spline_es <- plot_comparisons(\n  mod_lm_int_spline,\n  variables = \"trt\",\n  by = \"phq9_screen\"\n) +\n  geom_hline(yintercept = 0, linetype = \"dashed\") +\n  labs(\n    x = \"PHQ-9 at screening\",\n    y = \"Estimated Treatment Effect (95% CI)\",\n    color = \"Treatment group\",\n    fill = \"Treatment group\",\n    title = \"Treatment Effect\"\n  ) +\n  theme_minimal()\n\n# Combine plots\n(p_spline_trend + p_spline_es & theme(legend.position = \"bottom\")) +\n  plot_layout(guides = \"collect\") +\n  plot_annotation(\n    title = paste(\n      \"Spline Interaction Model: Treatment Effect\",\n      \"Varies Non-linearly with PHQ-9\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](regression-binary-and-numeric-predictors_files/figure-html/plot-spline-combined-1.png){width=960}\n:::\n:::\n\n\n::: {.callout-caution}\nDo these curves make sense? Do we believe that the relationships are this wiggly? We should  consider potential overfitting and fit a more constrained spline (e.g., changing `df` to 2 or 3)\n:::\n\n## Slightly More Complicated Hypothesis & Standardized Effects\nWe can estimate many other useful contrasts from the fitted model. For example, we might compare the treatment effect at PHQ-9 = 1 versus PHQ-9 = 15. The call below computes the difference between the two treatment effects at those PHQ-9 levels and then standardizes it by the baseline LSAS SD.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsd_baseline <- sd(df_red$lsas_screen, na.rm = TRUE)\n\navg_comparisons(\n  mod_lm_int_spline,\n  variables = \"trt\",\n  by = \"phq9_screen\",\n  newdata = datagrid(phq9_screen = c(1, 15)),\n  hypothesis = ~ reference | contrast,\n  transform = \\(x) x / sd_baseline,\n)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_f1kvw8honqt6xlvbsyc7 = TinyTable.createTableFunctions(\"tinytable_f1kvw8honqt6xlvbsyc7\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 } ], css_id: 'tinytable_css_zngc2gzq5gfpvp1trwj9',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 } ], css_id: 'tinytable_css_sjrzh05dyjhyu08eg1ie',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_f1kvw8honqt6xlvbsyc7.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_f1kvw8honqt6xlvbsyc7 td.tinytable_css_zngc2gzq5gfpvp1trwj9, #tinytable_f1kvw8honqt6xlvbsyc7 th.tinytable_css_zngc2gzq5gfpvp1trwj9 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_f1kvw8honqt6xlvbsyc7 td.tinytable_css_sjrzh05dyjhyu08eg1ie, #tinytable_f1kvw8honqt6xlvbsyc7 th.tinytable_css_sjrzh05dyjhyu08eg1ie {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_f1kvw8honqt6xlvbsyc7\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Hypothesis</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='5'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">(15) - (1)</td>\n                  <td data-row=\"1\" data-col=\"2\">2.7</td>\n                  <td data-row=\"1\" data-col=\"3\">0.06</td>\n                  <td data-row=\"1\" data-col=\"4\">-0.113</td>\n                  <td data-row=\"1\" data-col=\"5\">5.51</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n::: {.callout-tip}\n### Interpretation\nEstimated standardized difference in treatment effects between PHQ-9 = 1 and 15 is 2.7 SD units (95% CI: [-0.133, 5.51]).\n\nNote: The order of values in `newdata` determines the direction of the contrast when using `hypothesis = ~ reference | contrast` (the result is contrast minus reference). Swap the order if you prefer the opposite difference.\n:::\n\nWe could also compare the treatment effect at each level of PHQ-9 screen to the mean of all effects\n\n::: {.cell}\n\n```{.r .cell-code}\ncmp_meandev <- avg_comparisons(\n  mod_lm_int_spline,\n  variables = \"trt\",\n  by = \"phq9_screen\",\n  transform = \\(x) x / sd_baseline,\n  hypothesis = ~ meandev | contrast\n)\ncmp_meandev\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_2yhboz99y7d2bnwue6wb = TinyTable.createTableFunctions(\"tinytable_2yhboz99y7d2bnwue6wb\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '19', j: 1 }, { i: '19', j: 2 }, { i: '19', j: 3 }, { i: '19', j: 4 }, { i: '19', j: 5 } ], css_id: 'tinytable_css_tyfd7enycg6ik0gct4dp',}, \n          { positions: [ { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 } ], css_id: 'tinytable_css_5d6094px94sm5tnz914k',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_2yhboz99y7d2bnwue6wb.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_2yhboz99y7d2bnwue6wb td.tinytable_css_tyfd7enycg6ik0gct4dp, #tinytable_2yhboz99y7d2bnwue6wb th.tinytable_css_tyfd7enycg6ik0gct4dp {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    #tinytable_2yhboz99y7d2bnwue6wb td.tinytable_css_5d6094px94sm5tnz914k, #tinytable_2yhboz99y7d2bnwue6wb th.tinytable_css_5d6094px94sm5tnz914k {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%;  }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_2yhboz99y7d2bnwue6wb\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\">Hypothesis</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">Estimate</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Pr(&gt;|z|)</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"4\">2.5 %</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"5\">97.5 %</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='5'>Type: response\n</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">(1) - Mean</td>\n                  <td data-row=\"1\" data-col=\"2\">-2.1030</td>\n                  <td data-row=\"1\" data-col=\"3\">0.0642</td>\n                  <td data-row=\"1\" data-col=\"4\">-4.3298</td>\n                  <td data-row=\"1\" data-col=\"5\">0.124</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\">(2) - Mean</td>\n                  <td data-row=\"2\" data-col=\"2\">-1.2218</td>\n                  <td data-row=\"2\" data-col=\"3\">0.1177</td>\n                  <td data-row=\"2\" data-col=\"4\">-2.7522</td>\n                  <td data-row=\"2\" data-col=\"5\">0.309</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">(3) - Mean</td>\n                  <td data-row=\"3\" data-col=\"2\">-0.4127</td>\n                  <td data-row=\"3\" data-col=\"3\">0.4150</td>\n                  <td data-row=\"3\" data-col=\"4\">-1.4052</td>\n                  <td data-row=\"3\" data-col=\"5\">0.580</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\">(4) - Mean</td>\n                  <td data-row=\"4\" data-col=\"2\">0.2518</td>\n                  <td data-row=\"4\" data-col=\"3\">0.5257</td>\n                  <td data-row=\"4\" data-col=\"4\">-0.5258</td>\n                  <td data-row=\"4\" data-col=\"5\">1.029</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"1\">(5) - Mean</td>\n                  <td data-row=\"5\" data-col=\"2\">0.6995</td>\n                  <td data-row=\"5\" data-col=\"3\">0.1063</td>\n                  <td data-row=\"5\" data-col=\"4\">-0.1493</td>\n                  <td data-row=\"5\" data-col=\"5\">1.548</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"1\">(6) - Mean</td>\n                  <td data-row=\"6\" data-col=\"2\">0.8582</td>\n                  <td data-row=\"6\" data-col=\"3\">0.0662</td>\n                  <td data-row=\"6\" data-col=\"4\">-0.0574</td>\n                  <td data-row=\"6\" data-col=\"5\">1.774</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"1\">(7) - Mean</td>\n                  <td data-row=\"7\" data-col=\"2\">0.6557</td>\n                  <td data-row=\"7\" data-col=\"3\">0.1278</td>\n                  <td data-row=\"7\" data-col=\"4\">-0.1883</td>\n                  <td data-row=\"7\" data-col=\"5\">1.500</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"1\">(8) - Mean</td>\n                  <td data-row=\"8\" data-col=\"2\">0.1087</td>\n                  <td data-row=\"8\" data-col=\"3\">0.7914</td>\n                  <td data-row=\"8\" data-col=\"4\">-0.6970</td>\n                  <td data-row=\"8\" data-col=\"5\">0.914</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"1\">(9) - Mean</td>\n                  <td data-row=\"9\" data-col=\"2\">-0.4089</td>\n                  <td data-row=\"9\" data-col=\"3\">0.4013</td>\n                  <td data-row=\"9\" data-col=\"4\">-1.3636</td>\n                  <td data-row=\"9\" data-col=\"5\">0.546</td>\n                </tr>\n                <tr>\n                  <td data-row=\"10\" data-col=\"1\">(10) - Mean</td>\n                  <td data-row=\"10\" data-col=\"2\">-0.5393</td>\n                  <td data-row=\"10\" data-col=\"3\">0.2559</td>\n                  <td data-row=\"10\" data-col=\"4\">-1.4698</td>\n                  <td data-row=\"10\" data-col=\"5\">0.391</td>\n                </tr>\n                <tr>\n                  <td data-row=\"11\" data-col=\"1\">(11) - Mean</td>\n                  <td data-row=\"11\" data-col=\"2\">-0.3450</td>\n                  <td data-row=\"11\" data-col=\"3\">0.3905</td>\n                  <td data-row=\"11\" data-col=\"4\">-1.1324</td>\n                  <td data-row=\"11\" data-col=\"5\">0.442</td>\n                </tr>\n                <tr>\n                  <td data-row=\"12\" data-col=\"1\">(12) - Mean</td>\n                  <td data-row=\"12\" data-col=\"2\">0.0068</td>\n                  <td data-row=\"12\" data-col=\"3\">0.9870</td>\n                  <td data-row=\"12\" data-col=\"4\">-0.8116</td>\n                  <td data-row=\"12\" data-col=\"5\">0.825</td>\n                </tr>\n                <tr>\n                  <td data-row=\"13\" data-col=\"1\">(13) - Mean</td>\n                  <td data-row=\"13\" data-col=\"2\">0.3487</td>\n                  <td data-row=\"13\" data-col=\"3\">0.4958</td>\n                  <td data-row=\"13\" data-col=\"4\">-0.6546</td>\n                  <td data-row=\"13\" data-col=\"5\">1.352</td>\n                </tr>\n                <tr>\n                  <td data-row=\"14\" data-col=\"1\">(14) - Mean</td>\n                  <td data-row=\"14\" data-col=\"2\">0.5461</td>\n                  <td data-row=\"14\" data-col=\"3\">0.3170</td>\n                  <td data-row=\"14\" data-col=\"4\">-0.5234</td>\n                  <td data-row=\"14\" data-col=\"5\">1.616</td>\n                </tr>\n                <tr>\n                  <td data-row=\"15\" data-col=\"1\">(15) - Mean</td>\n                  <td data-row=\"15\" data-col=\"2\">0.5958</td>\n                  <td data-row=\"15\" data-col=\"3\">0.2276</td>\n                  <td data-row=\"15\" data-col=\"4\">-0.3721</td>\n                  <td data-row=\"15\" data-col=\"5\">1.564</td>\n                </tr>\n                <tr>\n                  <td data-row=\"16\" data-col=\"1\">(16) - Mean</td>\n                  <td data-row=\"16\" data-col=\"2\">0.5273</td>\n                  <td data-row=\"16\" data-col=\"3\">0.2014</td>\n                  <td data-row=\"16\" data-col=\"4\">-0.2816</td>\n                  <td data-row=\"16\" data-col=\"5\">1.336</td>\n                </tr>\n                <tr>\n                  <td data-row=\"17\" data-col=\"1\">(17) - Mean</td>\n                  <td data-row=\"17\" data-col=\"2\">0.3701</td>\n                  <td data-row=\"17\" data-col=\"3\">0.3926</td>\n                  <td data-row=\"17\" data-col=\"4\">-0.4783</td>\n                  <td data-row=\"17\" data-col=\"5\">1.219</td>\n                </tr>\n                <tr>\n                  <td data-row=\"18\" data-col=\"1\">(18) - Mean</td>\n                  <td data-row=\"18\" data-col=\"2\">0.1539</td>\n                  <td data-row=\"18\" data-col=\"3\">0.8073</td>\n                  <td data-row=\"18\" data-col=\"4\">-1.0826</td>\n                  <td data-row=\"18\" data-col=\"5\">1.390</td>\n                </tr>\n                <tr>\n                  <td data-row=\"19\" data-col=\"1\">(19) - Mean</td>\n                  <td data-row=\"19\" data-col=\"2\">-0.0919</td>\n                  <td data-row=\"19\" data-col=\"3\">0.9212</td>\n                  <td data-row=\"19\" data-col=\"4\">-1.9131</td>\n                  <td data-row=\"19\" data-col=\"5\">1.729</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nLet's plot it and compare it to our previous treatment effect vs. PHQ-9 figure.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_spline_meandev <- cmp_meandev |>\n  mutate(phq9_screen = row_number() + 1) |>\n  ggplot(aes(x = phq9_screen, y = estimate)) +\n  geom_line() +\n  geom_hline(yintercept = 0, linetype = \"dashed\") +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.15) +\n  labs(\n    title = \"Deviations from Mean Effect\",\n    x = \"PHQ-9 at screening\",\n    y = \"Deviation from mean effect (SD units, 95% CI)\"\n  ) +\n  theme_minimal()\n\np_spline_es + p_spline_meandev +\n  plot_annotation(\n    title = paste(\n      \"Spline Interaction Model: Treatment Effect\",\n      \"Varies Non-linearly with PHQ-9\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](regression-binary-and-numeric-predictors_files/figure-html/plot-meandev-contrast-standardized-1.png){width=960}\n:::\n:::\n\n\n::: {.callout-note}\nThe figure above illustrates point that [the difference between \"significant\" and \"not significant\" is not itself statistically significant](https://www.jstor.org/stable/27643811). In the left panel, the 95% CI for the treatment effect crosses 0 at some PHQ-9 values and not at others; this alone does not imply that the formal contrast between two treatment effects (e.g., PHQ-9 = 1 vs 15) is significant. The right panel shows that the direct comparison can be non-significant even when individual CIs differ in whether they include 0.\n:::\n\n# Summary\n\nIn this chapter you learned:\n\n- how to fit regression models with one binary and one numeric predictor\n- how conditional effects are interpreted when a moderator is continuous\n- the difference between additive (parallel slopes) and interaction models\n- how interactions change coefficient interpretation\n- how to estimate conditional and marginal effects using `marginaleffects`\n- how to visualize interactions using predicted values and treatment-effect curves\n\nThis chapter continues the foundation for working with **multiple predictors**, including both categorical and numeric variables.\n",
    "supporting": [
      "regression-binary-and-numeric-predictors_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
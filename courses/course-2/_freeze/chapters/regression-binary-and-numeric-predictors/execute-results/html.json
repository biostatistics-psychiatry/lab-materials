{
  "hash": "7cd6b6f9c6c6059ca2af04a0d4b8496a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Chapter 6: Regression with One Binary and One Numeric Predictor\"\nformat: html\ntoc: true\ntoc-depth: 3\n---\n\n# Introduction\n\nIn the previous chapter, we studied regression models with **two binary predictors**, and learned how to distinguish between:\n\n-   **additive models** (no interaction)\n-   **interaction models** (effect modification)\n\nIn this chapter, we extend these ideas to a model with:\n\n-   one **binary** predictor: `trt` (therapist-guided vs waitlist)\n-   one **numeric** predictor: `phq9_screen` (baseline depression severity)\n\nThis allows us to introduce conditional effects when the moderator is numeric, and to distinguish between:\n\n-   **parallel slopes** (no interaction): the treatment effect is constant across `phq9_screen`\n-   **effect modification** (interaction): the treatment effect varies with `phq9_screen`\n\nYou will learn:\n\n-   how to interpret models with one binary and one numeric predictor\n-   how conditional treatment effects vary across values of a numeric variable\n-   how interactions change interpretation\n-   how to estimate conditional and marginal effects using `marginaleffects`\n-   how to visualize interactions with predicted values\n\n# 1. Packages and Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \nlibrary(broom) \nlibrary(quantreg) \nlibrary(marginaleffects) \nlibrary(here)\n```\n:::\n\n\n## Load data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read.csv(here(\"data\", \"steps_clean.csv\"))\ndf <- df %>% rename(grp = group)\n```\n:::\n\n\nAs before, we use treatment group as our binary predictor. We subset the data to include only participants in the therapist-guided and waitlist conditions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_red <- subset(df, trt == \"therapist-guided\" | trt == \"waitlist\")\n\ndf_red$trt <- factor(df_red$trt,\nlevels = c(\"waitlist\", \"therapist-guided\"))\n```\n:::\n\n\nThe other predictor will be baseline depression severity measured continuously using `phq9_screen`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(df_red$phq9_screen)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   1.00    7.00    9.00    9.85   13.00   19.00 \n```\n\n\n:::\n:::\n\n\n# 2. One Binary and One Numeric Predictor without Interaction (Additive Model)\n\nWe begin with a model that includes both predictors **without** an interaction.\n\n## 2.1 Model formula\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlsas_post ~ trt + phq9_screen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nlsas_post ~ trt + phq9_screen\n```\n\n\n:::\n:::\n\n\nThis corresponds to the linear regression model:\n\n$$ E(LSAS_{post}) = \\beta_0 + \\beta_1 \\cdot trt + \\beta_2 \\cdot phq9\\_{screen}$$Where:\n\n-   $\\beta_0$ = mean outcome when `trt = waitlist` and `phq9_screen = 0`\n\n-   $\\beta_1$ = conditional treatment effect **holding PHQ-9 constant**\n\n-   $\\beta_2$ = conditional effect of PHQ-9 **holding treatment constant**\n\n## 2.2 Interpretation of conditional effects\n\nIn this model:\n\n-   the treatment effect is assumed to be **the same at all values of PHQ-9**\n\n-   the PHQ-9 slope is assumed to be **the same in both treatment groups**\n\nThis is an **additive model** (parallel slopes).\n\n# 3. Linear Regression without Interaction\n\n## 3.1 Fit the model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm_add <- lm(lsas_post ~ trt + phq9_screen, data = df_red)\nsummary(mod_lm_add)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ trt + phq9_screen, data = df_red)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-65.918 -13.561  -0.148  12.947  62.865 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)          63.3772     5.9399  10.670  < 2e-16 ***\ntrttherapist-guided -19.3976     4.4906  -4.320 3.46e-05 ***\nphq9_screen           1.4617     0.4919   2.972  0.00364 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 23.55 on 109 degrees of freedom\n  (8 observations deleted due to missingness)\nMultiple R-squared:  0.2229,\tAdjusted R-squared:  0.2086 \nF-statistic: 15.63 on 2 and 109 DF,  p-value: 1.074e-06\n```\n\n\n:::\n:::\n\n\n### Interpretation\n\n-   **Intercept**: mean LSAS at post when `trt = waitlist` and `phq9_screen = 0`\\\n    (note: `phq9_screen = 0` may be outside the range of the data, so the intercept is often not directly meaningful)\n\n-   **trt coefficient**: treatment effect adjusted for PHQ-9\n\n-   **phq9_screen coefficient**: association between baseline depression and post-treatment LSAS, adjusted for treatment\n\n## 3.2 Predicted means for each treatment group (averaged over PHQ-9)\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_predictions(mod_lm_add, by = \"trt\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n              trt Estimate Std. Error    z Pr(>|z|)     S 2.5 % 97.5 %\n waitlist             78.4       3.09 25.4   <0.001 469.1  72.4   84.5\n therapist-guided     57.4       3.21 17.9   <0.001 235.4  51.1   63.6\n\nType: response\n```\n\n\n:::\n:::\n\n\n## 3.3 Treatment effect as a conditional contrast\n\nBecause there is no interaction, the conditional treatment effect is the same for all PHQ-9 values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(mod_lm_add, variables = \"trt\",\n                by= \"phq9_screen\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n phq9_screen Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n           1    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n           2    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n           3    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n           4    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n           5    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n           6    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n           7    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n           8    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n           9    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n          10    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n          11    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n          12    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n          13    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n          14    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n          15    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n          16    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n          17    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n          18    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n          19    -19.4       4.49 -4.32   <0.001 16.0 -28.2  -10.6\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\n# 4. Adding an Interaction\n\nNow we allow the treatment effect to differ depending on baseline depression severity.\n\n## 4.1 Model formula with interaction\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlsas_post ~ trt * phq9_screen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nlsas_post ~ trt * phq9_screen\n```\n\n\n:::\n:::\n\n\nWhich expands to: $$ E(LSAS_{post}) = \\beta_0 + \\beta_1 trt + \\beta_2 phq9\\_{screen} + \\beta_3 (trt \\times phq9\\_{screen})$$\n\n-   $\\beta_3$ is the **interaction term**\n\n-   it captures how the treatment effect changes as PHQ-9 increases\n\nWe now allow the treatment effect to differ **depending on baseline depression**, rather than remaining constant across PHQ-9 values.\n\n# 5. Linear Regression with Interaction\n\n## 5.1 Fit the interaction model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_lm_int <- lm(lsas_post ~ trt * phq9_screen, data = df_red)\nsummary(mod_lm_int)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lsas_post ~ trt * phq9_screen, data = df_red)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-65.585 -13.229  -0.181  13.429  62.900 \n\nCoefficients:\n                                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                      65.4083     7.5650   8.646 5.45e-14 ***\ntrttherapist-guided             -23.5820    10.5995  -2.225   0.0282 *  \nphq9_screen                       1.2647     0.6691   1.890   0.0614 .  \ntrttherapist-guided:phq9_screen   0.4324     0.9913   0.436   0.6636    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 23.64 on 108 degrees of freedom\n  (8 observations deleted due to missingness)\nMultiple R-squared:  0.2243,\tAdjusted R-squared:  0.2027 \nF-statistic: 10.41 on 3 and 108 DF,  p-value: 4.513e-06\n```\n\n\n:::\n:::\n\n\n### Interpretation\n\n-   The treatment effect is **conditional on PHQ-9**\n\n-   Main effects are interpreted **at the reference level** of the other variable:\n\n    -   the `trt` coefficient is the treatment effect when `phq9_screen = 0`\n\n    -   the `phq9_screen` coefficient is the PHQ-9 slope in the waitlist group (reference level)\n\n-   The interaction coefficient represents **how much the treatment effect changes for a one-unit increase in PHQ-9 (0.4 points)**.\\\n    For example, a negative interaction means the treatment effect becomes more negative (larger improvement) at higher PHQ-9.\n\n## 5.2 Conditional treatment effects at selected PHQ-9 values\n\nA simple way to interpret the interaction is to estimate the treatment effect at several meaningful PHQ-9 values (e.g., low, medium, high).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphq_vals <- quantile(df_red$phq9_screen, probs = c(.25, .50, .75), na.rm = TRUE)\nphq_vals\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n25% 50% 75% \n  7   9  13 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\nmod_lm_int,\nvariables = \"trt\",\n# creating a new dataframe that only has three levels for phq9_screen\nnewdata = datagrid( \nnewdata = df_red,\nphq9_screen = phq_vals\n),\nby = \"phq9_screen\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n phq9_screen Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n           7    -20.6       5.23 -3.93  < 0.001 13.5 -30.8 -10.30\n           9    -19.7       4.56 -4.32  < 0.001 16.0 -28.6 -10.76\n          13    -18.0       5.58 -3.22  0.00129  9.6 -28.9  -7.02\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\nThese estimates answer:\n\n> *What is the treatment effect at low, medium, and high baseline depression?*\n\n## 5.3 Marginal treatment effect\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\nmod_lm_int,\nvariables = \"trt\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Estimate Std. Error    z Pr(>|z|)    S 2.5 % 97.5 %\n    -19.4       4.51 -4.3   <0.001 15.8 -28.2  -10.5\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\nThis is the **marginal (population-average) treatment effect**, obtained by averaging the conditional treatment effects over the observed distribution of PHQ-9 values in the sample.\n\n# 6. Quantile Regression with One Binary and One Numeric Predictor\n\nNow let's do the same thing with quantile regression (median regression).\n\n## 6.1 Additive model (median differences)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rq_add <- rq(\nlsas_post ~ trt + phq9_screen,\ntau = 0.5,\ndata = df_red\n)\nsummary(mod_rq_add)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall: rq(formula = lsas_post ~ trt + phq9_screen, tau = 0.5, data = df_red)\n\ntau: [1] 0.5\n\nCoefficients:\n                    coefficients lower bd  upper bd \n(Intercept)          64.66667     57.08606  77.29887\ntrttherapist-guided -22.75000    -29.61235 -19.19895\nphq9_screen           1.41667      0.04756   3.42108\n```\n\n\n:::\n:::\n\n\n## 6.2 Interaction model (median differences)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_rq_int <- rq(\nlsas_post ~ trt * phq9_screen,\ntau = 0.5,\ndata = df_red\n)\nsummary(mod_rq_int)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall: rq(formula = lsas_post ~ trt * phq9_screen, tau = 0.5, data = df_red)\n\ntau: [1] 0.5\n\nCoefficients:\n                                coefficients lower bd  upper bd \n(Intercept)                      62.00000     44.25040  79.43182\ntrttherapist-guided             -20.08333    -40.19799  -9.25694\nphq9_screen                       1.75000     -0.28541   3.80067\ntrttherapist-guided:phq9_screen  -0.33333     -2.42512   2.24221\n```\n\n\n:::\n:::\n\n\n## 6.3 Conditional median treatment effects at selected PHQ-9 values\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\nmod_rq_int,\nvariables = \"trt\",\nnewdata = datagrid(\nnewdata = df_red,\nphq9_screen = phq_vals\n),\nby = \"phq9_screen\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: 2 non-positive fis\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n phq9_screen Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n           7    -22.4       4.71 -4.75  < 0.001 18.9 -31.7 -13.18\n           9    -23.1       4.71 -4.90  < 0.001 20.0 -32.3 -13.85\n          13    -24.4       7.67 -3.18  0.00146  9.4 -39.4  -9.38\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\n## 6.4 Marginal median treatment effect\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_comparisons(\nmod_rq_int,\nvariables = \"trt\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: 2 non-positive fis\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n    -23.3       5.03 -4.63   <0.001 18.1 -33.2  -13.5\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\n# 7. Visualization\n\nTo visualize conditional effects when the moderator is numeric, it is useful to plot predicted values as a function of `phq9_screen`, separately by treatment group.\n\n## 7.1 Predicted means across PHQ-9 (additive model)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdat <- datagrid(\nnewdata = df_red,\nphq9_screen = seq(\nmin(df_red$phq9_screen, na.rm = TRUE),\nmax(df_red$phq9_screen, na.rm = TRUE),\nlength.out = 60\n),\ntrt = levels(df_red$trt)\n)\n\npred_add <- predictions(mod_lm_add, newdata = newdat)\n\nggplot(pred_add, aes(x = phq9_screen, y = estimate, color = trt)) +\ngeom_line(linewidth = 1) +\ngeom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill = trt), alpha = 0.15, color = NA) +\nlabs(\nx = \"PHQ-9 at screening\",\ny = \"Estimated Mean LSAS (95% CI)\",\ncolor = \"Treatment group\",\nfill = \"Treatment group\",\ntitle = \"Additive Model: Parallel Slopes (No Interaction)\"\n) +\ntheme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-binary-and-numeric-predictors_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nIn the additive model, the lines are parallel: the difference between treatment groups is constant across PHQ-9.\n\n## 7.2 Predicted means across PHQ-9 (interaction model)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_int <- predictions(mod_lm_int, newdata = newdat)\n\nggplot(pred_int, aes(x = phq9_screen, y = estimate, color = trt)) +\ngeom_line(linewidth = 1) +\ngeom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill = trt), alpha = 0.15, color = NA) +\nlabs(\nx = \"PHQ-9 at screening\",\ny = \"Estimated Mean LSAS (95% CI)\",\ncolor = \"Treatment group\",\nfill = \"Treatment group\",\ntitle = \"Interaction Model: Treatment Effect Varies with PHQ-9\"\n) +\ntheme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-binary-and-numeric-predictors_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\nIf the lines are not parallel, the treatment effect depends on baseline depression severity.\n\n## 7.3 Visualizing the conditional treatment effect across PHQ-9\n\nInstead of plotting predicted means, we can directly plot the estimated treatment effect as a function of PHQ-9.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncmp_curve <- comparisons(\nmod_lm_int,\nvariables = \"trt\",\nnewdata = datagrid(\nnewdata = df_red,\nphq9_screen = seq(\nmin(df_red$phq9_screen, na.rm = TRUE),\nmax(df_red$phq9_screen, na.rm = TRUE),\nlength.out = 60\n)\n)\n)\n\nggplot(cmp_curve, aes(x = phq9_screen, y = estimate)) +\ngeom_hline(yintercept = 0, linetype = \"dashed\") +\ngeom_line(linewidth = 1) +\ngeom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.2) +\nlabs(\nx = \"PHQ-9 at screening\",\ny = \"Estimated Treatment Effect (95% CI)\",\ntitle = \"Conditional Treatment Effect Across Baseline Depression\"\n) +\ntheme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-binary-and-numeric-predictors_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n## 7.4 Visualizing conditional treatment effects at three PHQ-9 levels\n\nWe can also visualize the treatment effect at low, medium, and high baseline depression by estimating the treatment effect at three values of `phq9_screen` (here: the 25th, 50th, and 75th percentiles).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# pick three PHQ-9 values (low, medium, high)\nphq_vals <- with(df_red, quantile(phq9_screen, probs = c(.25, .50, .75), na.rm = TRUE))\n\n# conditional treatment effects at these values\ncmp_3 <- avg_comparisons(\nmod_lm_int,\nvariables = \"trt\",\n# creating a new dataframe that only has three levels for phq9_screen\nnewdata = datagrid( \nnewdata = df_red,\nphq9_screen = phq_vals\n),\nby = \"phq9_screen\"\n)\n\ncmp_3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n phq9_screen Estimate Std. Error     z Pr(>|z|)    S 2.5 % 97.5 %\n           7    -20.6       5.23 -3.93  < 0.001 13.5 -30.8 -10.30\n           9    -19.7       4.56 -4.32  < 0.001 16.0 -28.6 -10.76\n          13    -18.0       5.58 -3.22  0.00129  9.6 -28.9  -7.02\n\nTerm: trt\nType: response\nComparison: therapist-guided - waitlist\n```\n\n\n:::\n:::\n\n\nTo make the plot easier to read, we label the three values as low/medium/high.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncmp_3 <- cmp_3 %>%\nmutate(\nphq_level = factor(\nphq9_screen,\nlevels = phq_vals,\nlabels = c(\"Low (25th pct)\", \"Medium (50th pct)\", \"High (75th pct)\")\n)\n)\n\nggplot(cmp_3, aes(x = phq_level, y = estimate)) +\n  geom_hline(yintercept = 0, linetype = \"dashed\") +\n  geom_point(size = 3) +\n  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +\n  labs(\n    x = \"Baseline depression severity (PHQ-9)\",\n    y = \"Estimated Treatment Effect (95% CI)\",\n    title = \"Conditional Treatment Effects at Three PHQ-9 Levels\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](regression-binary-and-numeric-predictors_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n# Summary\n\nIn this chapter you learned:\n\n-   how to fit regression models with one binary and one numeric predictor\n\n-   how conditional effects are interpreted when a moderator is continuous\n\n-   the difference between additive (parallel slopes) and interaction models\n\n-   how interactions change coefficient interpretation\n\n-   how to estimate conditional and marginal effects using `marginaleffects`\n\n-   how to visualize interactions using predicted values and treatment-effect curves\n\nThis chapter continues the foundation for working with **multiple predictors**, including both categorical and numeric variables.",
    "supporting": [
      "regression-binary-and-numeric-predictors_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}